[debug] [2025-11-19T00:11:50.583Z] ----------------------------------------------------------------------
[debug] [2025-11-19T00:11:50.584Z] Command:       /usr/local/bin/node /opt/homebrew/bin/firebase emulators:start --only functions,firestore
[debug] [2025-11-19T00:11:50.584Z] CLI Version:   14.25.0
[debug] [2025-11-19T00:11:50.584Z] Platform:      darwin
[debug] [2025-11-19T00:11:50.585Z] Node Version:  v22.14.0
[debug] [2025-11-19T00:11:50.585Z] Time:          Tue Nov 18 2025 19:11:50 GMT-0500 (Eastern Standard Time)
[debug] [2025-11-19T00:11:50.585Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-11-19T00:11:50.702Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-11-19T00:11:50.702Z] > authorizing via signed-in user (mscigliano94@gmail.com)
[debug] [2025-11-19T00:11:50.729Z] openjdk version "17.0.15" 2025-04-15

[debug] [2025-11-19T00:11:50.729Z] OpenJDK Runtime Environment Homebrew (build 17.0.15+0)
OpenJDK 64-Bit Server VM Homebrew (build 17.0.15+0, mixed mode, sharing)

[debug] [2025-11-19T00:11:50.731Z] Parsed Java major version: 17
[warn] ⬢  emulators: firebase-tools will drop support for Java version < 21 soon in firebase-tools@15. Please install a JDK at version 21 or above to get a compatible runtime. 
[info] i  emulators: Starting emulators: functions, firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: functions, firestore"}}
[debug] [2025-11-19T00:11:51.306Z] [logging] Logging Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-11-19T00:11:51.306Z] [firestore] Firestore Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-11-19T00:11:51.306Z] [firestore.websocket] websocket server for firestore only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-11-19T00:11:51.306Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-11-19T00:11:51.308Z] Emulator locator file path: /var/folders/8k/71zjnl9j7_58g18fylbn44sr0000gn/T/hub-platelens-3333.json
[debug] [2025-11-19T00:11:51.308Z] [hub] writing locator at /var/folders/8k/71zjnl9j7_58g18fylbn44sr0000gn/T/hub-platelens-3333.json
[debug] [2025-11-19T00:11:51.644Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-11-19T00:11:51.644Z] [eventarc] Eventarc Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-11-19T00:11:51.644Z] [tasks] Cloud Tasks Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-11-19T00:11:51.644Z] late-assigned ports for functions and eventarc emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}],"functions":[{"address":"127.0.0.1","family":"IPv4","port":5001}],"eventarc":[{"address":"127.0.0.1","family":"IPv4","port":9299}],"tasks":[{"address":"127.0.0.1","family":"IPv4","port":9499}]},"metadata":{"message":"late-assigned ports for functions and eventarc emulators"}}
[warn] ⚠  functions: The following emulators are not running, calls to these services from the Functions emulator will affect production: apphosting, auth, database, hosting, pubsub, storage, dataconnect {"metadata":{"emulator":{"name":"functions"},"message":"The following emulators are not running, calls to these services from the Functions emulator will affect production: \u001b[1mapphosting, auth, database, hosting, pubsub, storage, dataconnect\u001b[22m"}}
[debug] [2025-11-19T00:11:51.652Z] defaultcredentials: writing to file /Users/marianofacundoscigliano/.config/firebase/mscigliano94_gmail_com_application_default_credentials.json
[debug] [2025-11-19T00:11:51.653Z] Setting GAC to /Users/marianofacundoscigliano/.config/firebase/mscigliano94_gmail_com_application_default_credentials.json {"metadata":{"emulator":{"name":"functions"},"message":"Setting GAC to /Users/marianofacundoscigliano/.config/firebase/mscigliano94_gmail_com_application_default_credentials.json"}}
[debug] [2025-11-19T00:11:51.653Z] Checked if tokens are valid: false, expires at: 1763509360139
[debug] [2025-11-19T00:11:51.653Z] Checked if tokens are valid: false, expires at: 1763509360139
[debug] [2025-11-19T00:11:51.653Z] > refreshing access token with scopes: []
[debug] [2025-11-19T00:11:51.654Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2025-11-19T00:11:51.654Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-11-19T00:11:51.742Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2025-11-19T00:11:51.742Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-11-19T00:11:51.757Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/platelens-3333/adminSdkConfig [none]
[debug] [2025-11-19T00:11:51.992Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/platelens-3333/adminSdkConfig 200
[debug] [2025-11-19T00:11:51.992Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/platelens-3333/adminSdkConfig {"projectId":"platelens-3333","storageBucket":"platelens-3333.firebasestorage.app"}
[warn] ⚠  firestore: Cloud Firestore Emulator does not support multiple databases yet. {"metadata":{"emulator":{"name":"firestore"},"message":"Cloud Firestore Emulator does not support multiple databases yet."}}
[warn] ⚠  firestore: Did not find a Cloud Firestore rules file specified in a firebase.json config file. {"metadata":{"emulator":{"name":"firestore"},"message":"Did not find a Cloud Firestore rules file specified in a firebase.json config file."}}
[warn] ⚠  firestore: The emulator will default to allowing all reads and writes. Learn more about this option: https://firebase.google.com/docs/emulator-suite/install_and_configure#security_rules_configuration. {"metadata":{"emulator":{"name":"firestore"},"message":"The emulator will default to allowing all reads and writes. Learn more about this option: https://firebase.google.com/docs/emulator-suite/install_and_configure#security_rules_configuration."}}
[debug] [2025-11-19T00:11:52.004Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-11-19T00:11:52.004Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-11-19T00:11:52.004Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/Users/marianofacundoscigliano/.cache/firebase/emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","platelens-3333","--single_project_mode",true,"--functions_emulator","127.0.0.1:5001"],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/Users/marianofacundoscigliano/.cache/firebase/emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"platelens-3333\",\"--single_project_mode\",true,\"--functions_emulator\",\"127.0.0.1:5001\"],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to \u001b[1mfirestore-debug.log\u001b[22m"}}
[debug] [2025-11-19T00:11:52.605Z] Nov 18, 2025 7:11:52 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:11:52 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-11-19T00:11:52.618Z] API endpoint: http:// {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://"}}
[debug] [2025-11-19T00:11:52.618Z] 127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[info] i  functions: Watching "/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions" for Cloud Functions... {"metadata":{"emulator":{"name":"functions"},"message":"Watching \"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions\" for Cloud Functions..."}}
[debug] [2025-11-19T00:11:52.820Z] Validating nodejs source
[debug] [2025-11-19T00:11:53.111Z] > [functions] package.json contents: {
  "name": "platelens-functions",
  "version": "0.1.0",
  "main": "lib/index.js",
  "scripts": {
    "sync:shared": "node ./scripts/sync-shared.cjs",
    "build": "npm run sync:shared && tsc -p tsconfig.json",
    "clean": "rimraf lib src/shared",
    "deploy": "firebase deploy --only functions",
    "serve": "firebase emulators:start --only functions",
    "lint": "eslint --ext .ts src",
    "typecheck": "tsc --noEmit"
  },
  "engines": {
    "node": "20"
  },
  "dependencies": {
    "axios": "^1.7.7",
    "cors": "^2.8.5",
    "express": "^4.19.2",
    "firebase-admin": "^12.6.0",
    "firebase-functions": "^7.0.0",
    "form-data": "^4.0.0",
    "openai": "^4.77.0",
    "sharp-phash": "^2.0.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.17.6",
    "@typescript-eslint/eslint-plugin": "^8.11.0",
    "@typescript-eslint/parser": "^8.11.0",
    "eslint": "^8.57.1",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "rimraf": "^6.0.1",
    "typescript": "^5.6.3"
  }
}
[debug] [2025-11-19T00:11:53.111Z] Building nodejs source
[debug] [2025-11-19T00:11:53.112Z] Failed to find version of module node: reached end of search path /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules
[info] ✔  functions: Using node@22 from host. 
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T00:11:53.114Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-11-19T00:11:53.119Z] Found firebase-functions binary at '/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8234

[debug] [2025-11-19T00:11:53.558Z] Got response from /__/functions.yaml {"endpoints":{"api":{"availableMemoryMb":1024,"timeoutSeconds":120,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"httpsTrigger":{},"entryPoint":"api"},"scheduleNotifications":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"scheduleTrigger":{"schedule":"every 3 hours","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetrySeconds":null,"minBackoffSeconds":null,"maxBackoffSeconds":null},"timeZone":null},"entryPoint":"scheduleNotifications"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{}}
[debug] [2025-11-19T00:11:54.225Z] Nov 18, 2025 7:11:54 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:11:54 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[info] ✔  functions: Loaded functions definitions from source: api, scheduleNotifications. {"metadata":{"emulator":{"name":"functions"},"message":"Loaded functions definitions from source: api, scheduleNotifications."}}
[info] ✔  functions[us-central1-api]: http function initialized (http://127.0.0.1:5001/platelens-3333/us-central1/api). {"metadata":{"emulator":{"name":"functions"},"message":"\u001b[1mhttp\u001b[22m function initialized (http://127.0.0.1:5001/platelens-3333/us-central1/api)."}}
[info] i  functions[us-central1-scheduleNotifications]: function ignored because the pubsub emulator does not exist or is not running. {"metadata":{"emulator":{"name":"functions"},"message":"function ignored because the pubsub emulator does not exist or is not running."}}
[debug] [2025-11-19T00:11:57.577Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: . If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Functions │ 127.0.0.1:5001 │ http://127.0.0.1:4000/functions │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[warn] ⚠  emulators: firebase-tools will drop support for Java version < 21 soon in firebase-tools@15. Please install a JDK at version 21 or above to get a compatible runtime. 
[debug] [2025-11-19T00:11:58.202Z] Nov 18, 2025 7:11:58 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:11:58 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-11-19T00:11:58.204Z] Nov 18, 2025 7:11:58 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:11:58 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-11-19T00:12:05.943Z] [work-queue] {"queuedWork":["/platelens-3333/us-central1/api/v1/meals/today-2025-11-19T00:12:05.943Z"],"queueLength":1,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T00:12:05.944Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":["/platelens-3333/us-central1/api/v1/meals/today-2025-11-19T00:12:05.943Z"],"workRunningCount":1}
[debug] [2025-11-19T00:12:05.944Z] Accepted request GET /platelens-3333/us-central1/api/v1/meals/today?uid=test-user-123 --> us-central1-api
[debug] [2025-11-19T00:12:05.946Z] [functions] Runtime ready! Sending request! {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Runtime ready! Sending request!"}}
[debug] [2025-11-19T00:12:05.946Z] [functions] Got req.url=/platelens-3333/us-central1/api/v1/meals/today?uid=test-user-123, mapping to path=/v1/meals/today?uid=test-user-123 {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Got req.url=/platelens-3333/us-central1/api/v1/meals/today?uid=test-user-123, mapping to path=/v1/meals/today?uid=test-user-123"}}
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T00:12:05.949Z] [worker-pool] addWorker(us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] addWorker(us-central1-api)"}}
[debug] [2025-11-19T00:12:05.949Z] [worker-pool] Adding worker with key us-central1-api, total=1 {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] Adding worker with key us-central1-api, total=1"}}
[debug] [2025-11-19T00:12:06.227Z] Nov 18, 2025 7:12:06 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:12:06 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-11-19T00:12:06.230Z] Nov 18, 2025 7:12:06 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:12:06 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-11-19T00:12:06.547Z] [runtime-status] [11525] Resolved module firebase-admin {"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Resolved module firebase-admin {\"declared\":true,\"installed\":true,\"version\":\"12.7.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js\"}"}}
[debug] [2025-11-19T00:12:06.548Z] [runtime-status] [11525] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T00:12:06.548Z] [runtime-status] [11525] Outgoing network have been stubbed. [{"name":"http","status":"mocked"},{"name":"http","status":"mocked"},{"name":"https","status":"mocked"},{"name":"https","status":"mocked"},{"name":"net","status":"mocked"}] {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Outgoing network have been stubbed. [{\"name\":\"http\",\"status\":\"mocked\"},{\"name\":\"http\",\"status\":\"mocked\"},{\"name\":\"https\",\"status\":\"mocked\"},{\"name\":\"https\",\"status\":\"mocked\"},{\"name\":\"net\",\"status\":\"mocked\"}]"}}
[debug] [2025-11-19T00:12:06.548Z] [runtime-status] [11525] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T00:12:06.548Z] [runtime-status] [11525] Detected firebase-functions v7+, skipping config helper. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Detected firebase-functions v7+, skipping config helper."}}
[debug] [2025-11-19T00:12:06.549Z] [runtime-status] [11525] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T00:12:06.550Z] [runtime-status] [11525] Detected firebase-functions v7+, skipping legacy stubs. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Detected firebase-functions v7+, skipping legacy stubs."}}
[debug] [2025-11-19T00:12:06.550Z] [runtime-status] [11525] Resolved module firebase-admin {"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Resolved module firebase-admin {\"declared\":true,\"installed\":true,\"version\":\"12.7.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js\"}"}}
[debug] [2025-11-19T00:12:06.558Z] [runtime-status] [11525] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T00:12:06.706Z] [runtime-status] [11525] firebase-admin has been stubbed. {"adminResolution":{"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js"}} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] firebase-admin has been stubbed. {\"adminResolution\":{\"declared\":true,\"installed\":true,\"version\":\"12.7.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js\"}}"}}
[debug] [2025-11-19T00:12:06.920Z] [runtime-status] [11525] Functions runtime initialized. {"cwd":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions","node_version":"22.14.0"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Functions runtime initialized. {\"cwd\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions\",\"node_version\":\"22.14.0\"}"}}
[debug] [2025-11-19T00:12:06.920Z] [runtime-status] [11525] Listening to port: /var/folders/8k/71zjnl9j7_58g18fylbn44sr0000gn/T/fire_emu_140045a8a7631e81.sock {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [11525] Listening to port: /var/folders/8k/71zjnl9j7_58g18fylbn44sr0000gn/T/fire_emu_140045a8a7631e81.sock"}}
[debug] [2025-11-19T00:12:06.967Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: IDLE"}}
[debug] [2025-11-19T00:12:06.967Z] [worker-pool] submitRequest(triggerId=us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] submitRequest(triggerId=us-central1-api)"}}
[info] i  functions: Beginning execution of "us-central1-api" {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Beginning execution of \"us-central1-api\""}}
[debug] [2025-11-19T00:12:06.967Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: BUSY {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: BUSY"}}
[debug] [2025-11-19T00:12:07.093Z] Nov 18, 2025 7:12:07 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:12:07 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2025-11-19T00:12:07.471Z] Finishing up request with event=pause {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=pause"}}
[info] i  functions: Finished "us-central1-api" in 504.372083ms {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finished \"us-central1-api\" in 504.372083ms"}}
[debug] [2025-11-19T00:12:07.472Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: IDLE"}}
[debug] [2025-11-19T00:12:07.472Z] Finishing up request with event=finish {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=finish"}}
[debug] [2025-11-19T00:12:07.472Z] Finishing up request with event=close {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=close"}}
[debug] [2025-11-19T00:12:07.472Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T00:12:19.741Z] [work-queue] {"queuedWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T00:12:19.741Z"],"queueLength":1,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T00:12:19.741Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T00:12:19.741Z"],"workRunningCount":1}
[debug] [2025-11-19T00:12:19.741Z] Accepted request POST /platelens-3333/us-central1/api/v1/scan --> us-central1-api
[debug] [2025-11-19T00:12:19.744Z] [functions] Runtime ready! Sending request! {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Runtime ready! Sending request!"}}
[debug] [2025-11-19T00:12:19.744Z] [functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan"}}
[debug] [2025-11-19T00:12:19.744Z] [worker-pool] submitRequest(triggerId=us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] submitRequest(triggerId=us-central1-api)"}}
[info] i  functions: Beginning execution of "us-central1-api" {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Beginning execution of \"us-central1-api\""}}
[debug] [2025-11-19T00:12:19.745Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: BUSY {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: BUSY"}}
[info] >  Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required {"user":"Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required"}}
[info] >  This will become an error in a future version of the SDK. {"user":"This will become an error in a future version of the SDK.","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m This will become an error in a future version of the SDK."}}
[warn] ⚠  External network resource requested!
   - URL: "https://api.openai.com/v1/chat/completions"
 - Be careful, this may be a production service. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"External network resource requested!\n   - URL: \"https://api.openai.com/v1/chat/completions\"\n - Be careful, this may be a production service."}}
[debug] [2025-11-19T00:12:20.273Z] Nov 18, 2025 7:12:20 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:12:20 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-11-19T00:12:20.275Z] Nov 18, 2025 7:12:20 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:12:20 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[info] >  OpenAI vision detection error: BadRequestError: 400 Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead. {"user":"OpenAI vision detection error: BadRequestError: 400 Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m OpenAI vision detection error: BadRequestError: 400 Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead."}}
[info] >      at APIError.generate (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/error.js:45:20) {"user":"    at APIError.generate (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/error.js:45:20)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at APIError.generate (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/error.js:45:20)"}}
[info] >      at OpenAI.makeStatusError (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:302:33) {"user":"    at OpenAI.makeStatusError (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:302:33)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at OpenAI.makeStatusError (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:302:33)"}}
[info] >      at OpenAI.makeRequest (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:346:30) {"user":"    at OpenAI.makeRequest (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:346:30)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at OpenAI.makeRequest (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:346:30)"}}
[info] >      at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {"user":"    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at process.processTicksAndRejections (node:internal/process/task_queues:105:5)"}}
[info] >      at async /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:129:20 {"user":"    at async /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:129:20","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:129:20"}}
[info] >      at async retryWithBackoff (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:230:20) {"user":"    at async retryWithBackoff (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:230:20)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async retryWithBackoff (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:230:20)"}}
[info] >      at async detectFoodFromImage (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:128:28) {"user":"    at async detectFoodFromImage (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:128:28)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async detectFoodFromImage (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:128:28)"}}
[info] >      at async handleScan (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js:19:26) { {"user":"    at async handleScan (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js:19:26) {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async handleScan (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js:19:26) {"}}
[info] >    status: 400, {"user":"  status: 400,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   status: 400,"}}
[info] >    headers: { {"user":"  headers: {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   headers: {"}}
[info] >      'access-control-expose-headers': 'X-Request-ID', {"user":"    'access-control-expose-headers': 'X-Request-ID',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'access-control-expose-headers': 'X-Request-ID',"}}
[info] >      'alt-svc': 'h3=":443"; ma=86400', {"user":"    'alt-svc': 'h3=\":443\"; ma=86400',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'alt-svc': 'h3=\":443\"; ma=86400',"}}
[info] >      'cf-cache-status': 'DYNAMIC', {"user":"    'cf-cache-status': 'DYNAMIC',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'cf-cache-status': 'DYNAMIC',"}}
[info] >      'cf-ray': '9a0b7ed06fd60c83-MIA', {"user":"    'cf-ray': '9a0b7ed06fd60c83-MIA',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'cf-ray': '9a0b7ed06fd60c83-MIA',"}}
[info] >      connection: 'keep-alive', {"user":"    connection: 'keep-alive',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     connection: 'keep-alive',"}}
[info] >      'content-length': '245', {"user":"    'content-length': '245',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'content-length': '245',"}}
[info] >      'content-type': 'application/json', {"user":"    'content-type': 'application/json',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'content-type': 'application/json',"}}
[info] >      date: 'Wed, 19 Nov 2025 00:12:21 GMT', {"user":"    date: 'Wed, 19 Nov 2025 00:12:21 GMT',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     date: 'Wed, 19 Nov 2025 00:12:21 GMT',"}}
[info] >      'openai-organization': 'teamsquad', {"user":"    'openai-organization': 'teamsquad',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-organization': 'teamsquad',"}}
[info] >      'openai-processing-ms': '498', {"user":"    'openai-processing-ms': '498',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-processing-ms': '498',"}}
[info] >      'openai-project': 'proj_W75W4LWVMlP0dG4dTTAgnHKy', {"user":"    'openai-project': 'proj_W75W4LWVMlP0dG4dTTAgnHKy',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-project': 'proj_W75W4LWVMlP0dG4dTTAgnHKy',"}}
[info] >      'openai-version': '2020-10-01', {"user":"    'openai-version': '2020-10-01',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-version': '2020-10-01',"}}
[info] >      server: 'cloudflare', {"user":"    server: 'cloudflare',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     server: 'cloudflare',"}}
[info] >      'set-cookie': '__cf_bm=R1BR8gOs0EywJZtIgREUQNuBE7VfJkm4CyZOYlWK6K4-1763511141-1.0.1.1-hqI.wyeQeyO9JR8w7qt2kwB0Wka0dXzEptkbUDAwj872KUCrGA.ZfOarqIcvV8I2YGGqg0LI6Vzg.avOAi.yjcqQ0DV7uD7K.zNrbBBGgqU; path=/; expires=Wed, 19-Nov-25 00:42:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=09m2auM4sH0Vf2NOXLUbmkZFkbSTCgdFZgz7ina8LxQ-1763511141926-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None', {"user":"    'set-cookie': '__cf_bm=R1BR8gOs0EywJZtIgREUQNuBE7VfJkm4CyZOYlWK6K4-1763511141-1.0.1.1-hqI.wyeQeyO9JR8w7qt2kwB0Wka0dXzEptkbUDAwj872KUCrGA.ZfOarqIcvV8I2YGGqg0LI6Vzg.avOAi.yjcqQ0DV7uD7K.zNrbBBGgqU; path=/; expires=Wed, 19-Nov-25 00:42:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=09m2auM4sH0Vf2NOXLUbmkZFkbSTCgdFZgz7ina8LxQ-1763511141926-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'set-cookie': '__cf_bm=R1BR8gOs0EywJZtIgREUQNuBE7VfJkm4CyZOYlWK6K4-1763511141-1.0.1.1-hqI.wyeQeyO9JR8w7qt2kwB0Wka0dXzEptkbUDAwj872KUCrGA.ZfOarqIcvV8I2YGGqg0LI6Vzg.avOAi.yjcqQ0DV7uD7K.zNrbBBGgqU; path=/; expires=Wed, 19-Nov-25 00:42:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=09m2auM4sH0Vf2NOXLUbmkZFkbSTCgdFZgz7ina8LxQ-1763511141926-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None',"}}
[info] >      'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', {"user":"    'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',"}}
[info] >      'x-content-type-options': 'nosniff', {"user":"    'x-content-type-options': 'nosniff',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-content-type-options': 'nosniff',"}}
[info] >      'x-envoy-upstream-service-time': '609', {"user":"    'x-envoy-upstream-service-time': '609',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-envoy-upstream-service-time': '609',"}}
[info] >      'x-openai-proxy-wasm': 'v0.1', {"user":"    'x-openai-proxy-wasm': 'v0.1',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-openai-proxy-wasm': 'v0.1',"}}
[info] >      'x-ratelimit-limit-input-images': '250000', {"user":"    'x-ratelimit-limit-input-images': '250000',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-limit-input-images': '250000',"}}
[info] >      'x-ratelimit-limit-requests': '15000', {"user":"    'x-ratelimit-limit-requests': '15000',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-limit-requests': '15000',"}}
[info] >      'x-ratelimit-limit-tokens': '40000000', {"user":"    'x-ratelimit-limit-tokens': '40000000',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-limit-tokens': '40000000',"}}
[info] >      'x-ratelimit-remaining-input-images': '249999', {"user":"    'x-ratelimit-remaining-input-images': '249999',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-remaining-input-images': '249999',"}}
[info] >      'x-ratelimit-remaining-requests': '14999', {"user":"    'x-ratelimit-remaining-requests': '14999',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-remaining-requests': '14999',"}}
[info] >      'x-ratelimit-remaining-tokens': '39998470', {"user":"    'x-ratelimit-remaining-tokens': '39998470',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-remaining-tokens': '39998470',"}}
[info] >      'x-ratelimit-reset-input-images': '0s', {"user":"    'x-ratelimit-reset-input-images': '0s',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-reset-input-images': '0s',"}}
[info] >      'x-ratelimit-reset-requests': '4ms', {"user":"    'x-ratelimit-reset-requests': '4ms',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-reset-requests': '4ms',"}}
[info] >      'x-ratelimit-reset-tokens': '2ms', {"user":"    'x-ratelimit-reset-tokens': '2ms',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-reset-tokens': '2ms',"}}
[info] >      'x-request-id': 'req_f5c408177a57429e9879cc4d452ee01a' {"user":"    'x-request-id': 'req_f5c408177a57429e9879cc4d452ee01a'","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-request-id': 'req_f5c408177a57429e9879cc4d452ee01a'"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    request_id: 'req_f5c408177a57429e9879cc4d452ee01a', {"user":"  request_id: 'req_f5c408177a57429e9879cc4d452ee01a',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   request_id: 'req_f5c408177a57429e9879cc4d452ee01a',"}}
[info] >    error: { {"user":"  error: {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   error: {"}}
[info] >      message: "Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.", {"user":"    message: \"Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     message: \"Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.\","}}
[info] >      type: 'invalid_request_error', {"user":"    type: 'invalid_request_error',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     type: 'invalid_request_error',"}}
[info] >      param: 'max_tokens', {"user":"    param: 'max_tokens',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     param: 'max_tokens',"}}
[info] >      code: 'unsupported_parameter' {"user":"    code: 'unsupported_parameter'","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     code: 'unsupported_parameter'"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    code: 'unsupported_parameter', {"user":"  code: 'unsupported_parameter',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   code: 'unsupported_parameter',"}}
[info] >    param: 'max_tokens', {"user":"  param: 'max_tokens',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   param: 'max_tokens',"}}
[info] >    type: 'invalid_request_error' {"user":"  type: 'invalid_request_error'","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   type: 'invalid_request_error'"}}
[info] >  } {"user":"}","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m }"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  SCAN HANDLER - SENDING TO FRONTEND: {"user":"SCAN HANDLER - SENDING TO FRONTEND:","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m SCAN HANDLER - SENDING TO FRONTEND:"}}
[info] >  Dish Title: Unknown Dish {"user":"Dish Title: Unknown Dish","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Dish Title: Unknown Dish"}}
[info] >  Number of items: 0 {"user":"Number of items: 0","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Number of items: 0"}}
[info] >  Items: [] {"user":"Items: []","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Items: []"}}
[info] >  Totals: { calories: 0, p: 0, c: 0, f: 0 } {"user":"Totals: { calories: 0, p: 0, c: 0, f: 0 }","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Totals: { calories: 0, p: 0, c: 0, f: 0 }"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[debug] [2025-11-19T00:12:21.944Z] Finishing up request with event=pause {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=pause"}}
[info] i  functions: Finished "us-central1-api" in 2198.859625ms {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finished \"us-central1-api\" in 2198.859625ms"}}
[debug] [2025-11-19T00:12:21.944Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: IDLE"}}
[debug] [2025-11-19T00:12:21.944Z] Finishing up request with event=finish {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=finish"}}
[debug] [2025-11-19T00:12:21.944Z] Finishing up request with event=close {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=close"}}
[debug] [2025-11-19T00:12:21.944Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T00:12:35.914Z] [work-queue] {"queuedWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T00:12:35.914Z"],"queueLength":1,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T00:12:35.915Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T00:12:35.914Z"],"workRunningCount":1}
[debug] [2025-11-19T00:12:35.915Z] Accepted request POST /platelens-3333/us-central1/api/v1/scan --> us-central1-api
[debug] [2025-11-19T00:12:35.919Z] [functions] Runtime ready! Sending request! {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Runtime ready! Sending request!"}}
[debug] [2025-11-19T00:12:35.919Z] [functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan"}}
[debug] [2025-11-19T00:12:35.919Z] [worker-pool] submitRequest(triggerId=us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] submitRequest(triggerId=us-central1-api)"}}
[info] i  functions: Beginning execution of "us-central1-api" {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Beginning execution of \"us-central1-api\""}}
[debug] [2025-11-19T00:12:35.919Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: BUSY {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: BUSY"}}
[info] >  Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required {"user":"Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required"}}
[info] >  This will become an error in a future version of the SDK. {"user":"This will become an error in a future version of the SDK.","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m This will become an error in a future version of the SDK."}}
[debug] [2025-11-19T00:12:36.331Z] Nov 18, 2025 7:12:36 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:12:36 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-11-19T00:12:36.338Z] Nov 18, 2025 7:12:36 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 7:12:36 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[info] >  OpenAI vision detection error: BadRequestError: 400 Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead. {"user":"OpenAI vision detection error: BadRequestError: 400 Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m OpenAI vision detection error: BadRequestError: 400 Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead."}}
[info] >      at APIError.generate (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/error.js:45:20) {"user":"    at APIError.generate (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/error.js:45:20)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at APIError.generate (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/error.js:45:20)"}}
[info] >      at OpenAI.makeStatusError (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:302:33) {"user":"    at OpenAI.makeStatusError (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:302:33)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at OpenAI.makeStatusError (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:302:33)"}}
[info] >      at OpenAI.makeRequest (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:346:30) {"user":"    at OpenAI.makeRequest (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:346:30)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at OpenAI.makeRequest (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:346:30)"}}
[info] >      at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {"user":"    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at process.processTicksAndRejections (node:internal/process/task_queues:105:5)"}}
[info] >      at async /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:129:20 {"user":"    at async /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:129:20","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:129:20"}}
[info] >      at async retryWithBackoff (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:230:20) {"user":"    at async retryWithBackoff (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:230:20)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async retryWithBackoff (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:230:20)"}}
[info] >      at async detectFoodFromImage (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:128:28) {"user":"    at async detectFoodFromImage (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:128:28)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async detectFoodFromImage (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:128:28)"}}
[info] >      at async handleScan (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js:19:26) { {"user":"    at async handleScan (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js:19:26) {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async handleScan (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js:19:26) {"}}
[info] >    status: 400, {"user":"  status: 400,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   status: 400,"}}
[info] >    headers: { {"user":"  headers: {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   headers: {"}}
[info] >      'access-control-expose-headers': 'X-Request-ID', {"user":"    'access-control-expose-headers': 'X-Request-ID',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'access-control-expose-headers': 'X-Request-ID',"}}
[info] >      'alt-svc': 'h3=":443"; ma=86400', {"user":"    'alt-svc': 'h3=\":443\"; ma=86400',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'alt-svc': 'h3=\":443\"; ma=86400',"}}
[info] >      'cf-cache-status': 'DYNAMIC', {"user":"    'cf-cache-status': 'DYNAMIC',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'cf-cache-status': 'DYNAMIC',"}}
[info] >      'cf-ray': '9a0b7f3518c7cc76-TPA', {"user":"    'cf-ray': '9a0b7f3518c7cc76-TPA',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'cf-ray': '9a0b7f3518c7cc76-TPA',"}}
[info] >      connection: 'keep-alive', {"user":"    connection: 'keep-alive',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     connection: 'keep-alive',"}}
[info] >      'content-length': '245', {"user":"    'content-length': '245',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'content-length': '245',"}}
[info] >      'content-type': 'application/json', {"user":"    'content-type': 'application/json',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'content-type': 'application/json',"}}
[info] >      date: 'Wed, 19 Nov 2025 00:12:41 GMT', {"user":"    date: 'Wed, 19 Nov 2025 00:12:41 GMT',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     date: 'Wed, 19 Nov 2025 00:12:41 GMT',"}}
[info] >      'openai-organization': 'teamsquad', {"user":"    'openai-organization': 'teamsquad',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-organization': 'teamsquad',"}}
[info] >      'openai-processing-ms': '775', {"user":"    'openai-processing-ms': '775',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-processing-ms': '775',"}}
[info] >      'openai-project': 'proj_W75W4LWVMlP0dG4dTTAgnHKy', {"user":"    'openai-project': 'proj_W75W4LWVMlP0dG4dTTAgnHKy',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-project': 'proj_W75W4LWVMlP0dG4dTTAgnHKy',"}}
[info] >      'openai-version': '2020-10-01', {"user":"    'openai-version': '2020-10-01',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-version': '2020-10-01',"}}
[info] >      server: 'cloudflare', {"user":"    server: 'cloudflare',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     server: 'cloudflare',"}}
[info] >      'set-cookie': '__cf_bm=MypF8R9MylOGgoA1OahDSWzFeuStpt2orCY9h3YbCn0-1763511161-1.0.1.1-30QXFSXIeL5fQ6qoEsQ5QQBup97n8dSlhYR.XTYr9zof4iXbjrm44NHJ3ZqGFfiwV_eAbnOK3lUX3qe8MlcYhGxwSWelB3RmEXE4Hq1b5q8; path=/; expires=Wed, 19-Nov-25 00:42:41 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=JOnQ7a6j.SS3eVeYHlDUL8CUNR3neU9djhFapm7hdH4-1763511161769-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None', {"user":"    'set-cookie': '__cf_bm=MypF8R9MylOGgoA1OahDSWzFeuStpt2orCY9h3YbCn0-1763511161-1.0.1.1-30QXFSXIeL5fQ6qoEsQ5QQBup97n8dSlhYR.XTYr9zof4iXbjrm44NHJ3ZqGFfiwV_eAbnOK3lUX3qe8MlcYhGxwSWelB3RmEXE4Hq1b5q8; path=/; expires=Wed, 19-Nov-25 00:42:41 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=JOnQ7a6j.SS3eVeYHlDUL8CUNR3neU9djhFapm7hdH4-1763511161769-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'set-cookie': '__cf_bm=MypF8R9MylOGgoA1OahDSWzFeuStpt2orCY9h3YbCn0-1763511161-1.0.1.1-30QXFSXIeL5fQ6qoEsQ5QQBup97n8dSlhYR.XTYr9zof4iXbjrm44NHJ3ZqGFfiwV_eAbnOK3lUX3qe8MlcYhGxwSWelB3RmEXE4Hq1b5q8; path=/; expires=Wed, 19-Nov-25 00:42:41 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=JOnQ7a6j.SS3eVeYHlDUL8CUNR3neU9djhFapm7hdH4-1763511161769-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None',"}}
[info] >      'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', {"user":"    'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',"}}
[info] >      'x-content-type-options': 'nosniff', {"user":"    'x-content-type-options': 'nosniff',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-content-type-options': 'nosniff',"}}
[info] >      'x-envoy-upstream-service-time': '1107', {"user":"    'x-envoy-upstream-service-time': '1107',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-envoy-upstream-service-time': '1107',"}}
[info] >      'x-openai-proxy-wasm': 'v0.1', {"user":"    'x-openai-proxy-wasm': 'v0.1',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-openai-proxy-wasm': 'v0.1',"}}
[info] >      'x-ratelimit-limit-input-images': '250000', {"user":"    'x-ratelimit-limit-input-images': '250000',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-limit-input-images': '250000',"}}
[info] >      'x-ratelimit-limit-requests': '15000', {"user":"    'x-ratelimit-limit-requests': '15000',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-limit-requests': '15000',"}}
[info] >      'x-ratelimit-limit-tokens': '40000000', {"user":"    'x-ratelimit-limit-tokens': '40000000',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-limit-tokens': '40000000',"}}
[info] >      'x-ratelimit-remaining-input-images': '249999', {"user":"    'x-ratelimit-remaining-input-images': '249999',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-remaining-input-images': '249999',"}}
[info] >      'x-ratelimit-remaining-requests': '14999', {"user":"    'x-ratelimit-remaining-requests': '14999',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-remaining-requests': '14999',"}}
[info] >      'x-ratelimit-remaining-tokens': '39998470', {"user":"    'x-ratelimit-remaining-tokens': '39998470',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-remaining-tokens': '39998470',"}}
[info] >      'x-ratelimit-reset-input-images': '0s', {"user":"    'x-ratelimit-reset-input-images': '0s',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-reset-input-images': '0s',"}}
[info] >      'x-ratelimit-reset-requests': '4ms', {"user":"    'x-ratelimit-reset-requests': '4ms',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-reset-requests': '4ms',"}}
[info] >      'x-ratelimit-reset-tokens': '2ms', {"user":"    'x-ratelimit-reset-tokens': '2ms',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-reset-tokens': '2ms',"}}
[info] >      'x-request-id': 'req_da7f73b4f0384bf0bb2c21d472e1ccd4' {"user":"    'x-request-id': 'req_da7f73b4f0384bf0bb2c21d472e1ccd4'","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-request-id': 'req_da7f73b4f0384bf0bb2c21d472e1ccd4'"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    request_id: 'req_da7f73b4f0384bf0bb2c21d472e1ccd4', {"user":"  request_id: 'req_da7f73b4f0384bf0bb2c21d472e1ccd4',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   request_id: 'req_da7f73b4f0384bf0bb2c21d472e1ccd4',"}}
[info] >    error: { {"user":"  error: {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   error: {"}}
[info] >      message: "Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.", {"user":"    message: \"Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     message: \"Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.\","}}
[info] >      type: 'invalid_request_error', {"user":"    type: 'invalid_request_error',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     type: 'invalid_request_error',"}}
[info] >      param: 'max_tokens', {"user":"    param: 'max_tokens',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     param: 'max_tokens',"}}
[info] >      code: 'unsupported_parameter' {"user":"    code: 'unsupported_parameter'","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     code: 'unsupported_parameter'"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    code: 'unsupported_parameter', {"user":"  code: 'unsupported_parameter',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   code: 'unsupported_parameter',"}}
[info] >    param: 'max_tokens', {"user":"  param: 'max_tokens',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   param: 'max_tokens',"}}
[info] >    type: 'invalid_request_error' {"user":"  type: 'invalid_request_error'","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   type: 'invalid_request_error'"}}
[info] >  } {"user":"}","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m }"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  SCAN HANDLER - SENDING TO FRONTEND: {"user":"SCAN HANDLER - SENDING TO FRONTEND:","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m SCAN HANDLER - SENDING TO FRONTEND:"}}
[info] >  Dish Title: Unknown Dish {"user":"Dish Title: Unknown Dish","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Dish Title: Unknown Dish"}}
[info] >  Number of items: 0 {"user":"Number of items: 0","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Number of items: 0"}}
[info] >  Items: [] {"user":"Items: []","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Items: []"}}
[info] >  Totals: { calories: 0, p: 0, c: 0, f: 0 } {"user":"Totals: { calories: 0, p: 0, c: 0, f: 0 }","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Totals: { calories: 0, p: 0, c: 0, f: 0 }"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[debug] [2025-11-19T00:12:41.783Z] Finishing up request with event=pause {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=pause"}}
[info] i  functions: Finished "us-central1-api" in 5863.443792ms {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finished \"us-central1-api\" in 5863.443792ms"}}
[debug] [2025-11-19T00:12:41.783Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: IDLE"}}
[debug] [2025-11-19T00:12:41.783Z] Finishing up request with event=finish {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=finish"}}
[debug] [2025-11-19T00:12:41.783Z] Finishing up request with event=close {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=close"}}
[debug] [2025-11-19T00:12:41.783Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T00:13:49.645Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/lib/openai.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/lib/openai.ts changed, reloading triggers"}}
[debug] [2025-11-19T00:13:50.646Z] Validating nodejs source
[debug] [2025-11-19T00:13:51.100Z] > [functions] package.json contents: {
  "name": "platelens-functions",
  "version": "0.1.0",
  "main": "lib/index.js",
  "scripts": {
    "sync:shared": "node ./scripts/sync-shared.cjs",
    "build": "npm run sync:shared && tsc -p tsconfig.json",
    "clean": "rimraf lib src/shared",
    "deploy": "firebase deploy --only functions",
    "serve": "firebase emulators:start --only functions",
    "lint": "eslint --ext .ts src",
    "typecheck": "tsc --noEmit"
  },
  "engines": {
    "node": "20"
  },
  "dependencies": {
    "axios": "^1.7.7",
    "cors": "^2.8.5",
    "express": "^4.19.2",
    "firebase-admin": "^12.6.0",
    "firebase-functions": "^7.0.0",
    "form-data": "^4.0.0",
    "openai": "^4.77.0",
    "sharp-phash": "^2.0.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.17.6",
    "@typescript-eslint/eslint-plugin": "^8.11.0",
    "@typescript-eslint/parser": "^8.11.0",
    "eslint": "^8.57.1",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "rimraf": "^6.0.1",
    "typescript": "^5.6.3"
  }
}
[debug] [2025-11-19T00:13:51.100Z] Building nodejs source
[debug] [2025-11-19T00:13:51.100Z] Failed to find version of module node: reached end of search path /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules
[info] ✔  functions: Using node@22 from host. 
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T00:13:51.101Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-11-19T00:13:51.102Z] Found firebase-functions binary at '/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8202

[debug] [2025-11-19T00:13:51.303Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/ai.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/ai.ts changed, reloading triggers"}}
[debug] [2025-11-19T00:13:51.303Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/data/foodDensity.json changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/data/foodDensity.json changed, reloading triggers"}}
[debug] [2025-11-19T00:13:51.303Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/remoteConfig.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/remoteConfig.ts changed, reloading triggers"}}
[debug] [2025-11-19T00:13:51.303Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/types/firestore.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/types/firestore.ts changed, reloading triggers"}}
[debug] [2025-11-19T00:13:51.303Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/brand.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/brand.ts changed, reloading triggers"}}
[debug] [2025-11-19T00:13:51.470Z] Got response from /__/functions.yaml {"endpoints":{"api":{"availableMemoryMb":1024,"timeoutSeconds":120,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"httpsTrigger":{},"entryPoint":"api"},"scheduleNotifications":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"scheduleTrigger":{"schedule":"every 3 hours","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetrySeconds":null,"minBackoffSeconds":null,"maxBackoffSeconds":null},"timeZone":null},"entryPoint":"scheduleNotifications"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{}}
[debug] [2025-11-19T00:13:52.209Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/remoteConfig.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/remoteConfig.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.209Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/env.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/env.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.209Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/data/foodDensity.json changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/data/foodDensity.json changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.209Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.209Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/config.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/config.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.209Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/logs.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/logs.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.209Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/devices.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/devices.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.209Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/firebase.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/firebase.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/brand.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/brand.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/types/firestore.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/types/firestore.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/index.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/index.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/revenuecat.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/revenuecat.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/ai.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/ai.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/nutrition.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/nutrition.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/notify.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/notify.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/meals.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/meals.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:52.309Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/jobs/notificationCadence.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/jobs/notificationCadence.js changed, reloading triggers"}}
[debug] [2025-11-19T00:13:53.310Z] Validating nodejs source
[debug] [2025-11-19T00:13:53.628Z] > [functions] package.json contents: {
  "name": "platelens-functions",
  "version": "0.1.0",
  "main": "lib/index.js",
  "scripts": {
    "sync:shared": "node ./scripts/sync-shared.cjs",
    "build": "npm run sync:shared && tsc -p tsconfig.json",
    "clean": "rimraf lib src/shared",
    "deploy": "firebase deploy --only functions",
    "serve": "firebase emulators:start --only functions",
    "lint": "eslint --ext .ts src",
    "typecheck": "tsc --noEmit"
  },
  "engines": {
    "node": "20"
  },
  "dependencies": {
    "axios": "^1.7.7",
    "cors": "^2.8.5",
    "express": "^4.19.2",
    "firebase-admin": "^12.6.0",
    "firebase-functions": "^7.0.0",
    "form-data": "^4.0.0",
    "openai": "^4.77.0",
    "sharp-phash": "^2.0.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.17.6",
    "@typescript-eslint/eslint-plugin": "^8.11.0",
    "@typescript-eslint/parser": "^8.11.0",
    "eslint": "^8.57.1",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "rimraf": "^6.0.1",
    "typescript": "^5.6.3"
  }
}
[debug] [2025-11-19T00:13:53.628Z] Building nodejs source
[debug] [2025-11-19T00:13:53.628Z] Failed to find version of module node: reached end of search path /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules
[info] ✔  functions: Using node@22 from host. 
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T00:13:53.628Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-11-19T00:13:53.629Z] Found firebase-functions binary at '/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8116

[debug] [2025-11-19T00:13:53.836Z] Got response from /__/functions.yaml {"endpoints":{"api":{"availableMemoryMb":1024,"timeoutSeconds":120,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"httpsTrigger":{},"entryPoint":"api"},"scheduleNotifications":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"scheduleTrigger":{"schedule":"every 3 hours","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetrySeconds":null,"minBackoffSeconds":null,"maxBackoffSeconds":null},"timeZone":null},"entryPoint":"scheduleNotifications"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{}}
[info] ✔  functions: Loaded functions definitions from source: api, scheduleNotifications. {"metadata":{"emulator":{"name":"functions"},"message":"Loaded functions definitions from source: api, scheduleNotifications."}}
[debug] [2025-11-19T00:13:55.485Z] [worker-pool] Shutting down IDLE worker (us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] Shutting down IDLE worker (us-central1-api)"}}
[debug] [2025-11-19T00:13:55.485Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: FINISHING {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: FINISHING"}}
[debug] [2025-11-19T00:13:55.490Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: exited {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: exited"}}
[debug] [2025-11-19T00:13:55.490Z] [worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: FINISHED {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-243a4777-d2aa-4516-8030-28e68b2467cd]: FINISHED"}}
[info] ✔  functions: Loaded functions definitions from source: api, scheduleNotifications. {"metadata":{"emulator":{"name":"functions"},"message":"Loaded functions definitions from source: api, scheduleNotifications."}}
[debug] [2025-11-19T01:00:14.512Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/lib/openai.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/lib/openai.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:00:15.514Z] Validating nodejs source
[debug] [2025-11-19T01:00:16.069Z] > [functions] package.json contents: {
  "name": "platelens-functions",
  "version": "0.1.0",
  "main": "lib/index.js",
  "scripts": {
    "sync:shared": "node ./scripts/sync-shared.cjs",
    "build": "npm run sync:shared && tsc -p tsconfig.json",
    "clean": "rimraf lib src/shared",
    "deploy": "firebase deploy --only functions",
    "serve": "firebase emulators:start --only functions",
    "lint": "eslint --ext .ts src",
    "typecheck": "tsc --noEmit"
  },
  "engines": {
    "node": "20"
  },
  "dependencies": {
    "axios": "^1.7.7",
    "cors": "^2.8.5",
    "express": "^4.19.2",
    "firebase-admin": "^12.6.0",
    "firebase-functions": "^7.0.0",
    "form-data": "^4.0.0",
    "openai": "^4.77.0",
    "sharp-phash": "^2.0.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.17.6",
    "@typescript-eslint/eslint-plugin": "^8.11.0",
    "@typescript-eslint/parser": "^8.11.0",
    "eslint": "^8.57.1",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "rimraf": "^6.0.1",
    "typescript": "^5.6.3"
  }
}
[debug] [2025-11-19T01:00:16.069Z] Building nodejs source
[debug] [2025-11-19T01:00:16.069Z] Failed to find version of module node: reached end of search path /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules
[info] ✔  functions: Using node@22 from host. 
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T01:00:16.071Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-11-19T01:00:16.072Z] Found firebase-functions binary at '/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8089

[debug] [2025-11-19T01:00:16.535Z] Got response from /__/functions.yaml {"endpoints":{"api":{"availableMemoryMb":1024,"timeoutSeconds":120,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"httpsTrigger":{},"entryPoint":"api"},"scheduleNotifications":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"scheduleTrigger":{"schedule":"every 3 hours","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetrySeconds":null,"minBackoffSeconds":null,"maxBackoffSeconds":null},"timeZone":null},"entryPoint":"scheduleNotifications"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{}}
[debug] [2025-11-19T01:00:17.279Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/ai.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/ai.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:00:17.279Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/remoteConfig.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/remoteConfig.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:00:17.279Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/data/foodDensity.json changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/data/foodDensity.json changed, reloading triggers"}}
[debug] [2025-11-19T01:00:17.279Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/types/firestore.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/types/firestore.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:00:17.279Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/brand.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/brand.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.280Z] Validating nodejs source
[debug] [2025-11-19T01:00:18.692Z] > [functions] package.json contents: {
  "name": "platelens-functions",
  "version": "0.1.0",
  "main": "lib/index.js",
  "scripts": {
    "sync:shared": "node ./scripts/sync-shared.cjs",
    "build": "npm run sync:shared && tsc -p tsconfig.json",
    "clean": "rimraf lib src/shared",
    "deploy": "firebase deploy --only functions",
    "serve": "firebase emulators:start --only functions",
    "lint": "eslint --ext .ts src",
    "typecheck": "tsc --noEmit"
  },
  "engines": {
    "node": "20"
  },
  "dependencies": {
    "axios": "^1.7.7",
    "cors": "^2.8.5",
    "express": "^4.19.2",
    "firebase-admin": "^12.6.0",
    "firebase-functions": "^7.0.0",
    "form-data": "^4.0.0",
    "openai": "^4.77.0",
    "sharp-phash": "^2.0.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.17.6",
    "@typescript-eslint/eslint-plugin": "^8.11.0",
    "@typescript-eslint/parser": "^8.11.0",
    "eslint": "^8.57.1",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "rimraf": "^6.0.1",
    "typescript": "^5.6.3"
  }
}
[debug] [2025-11-19T01:00:18.692Z] Building nodejs source
[debug] [2025-11-19T01:00:18.692Z] Failed to find version of module node: reached end of search path /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules
[info] ✔  functions: Using node@22 from host. 
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T01:00:18.693Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-11-19T01:00:18.694Z] Found firebase-functions binary at '/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/.bin/firebase-functions'
[debug] [2025-11-19T01:00:18.694Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/notify.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/notify.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/revenuecat.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/revenuecat.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/data/foodDensity.json changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/data/foodDensity.json changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/types/firestore.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/types/firestore.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/logs.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/logs.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/nutrition.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/nutrition.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/remoteConfig.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/remoteConfig.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/index.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/index.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/jobs/notificationCadence.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/jobs/notificationCadence.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/ai.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/ai.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/meals.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/meals.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/devices.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/devices.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/firebase.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/firebase.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/config.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/config.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/env.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/env.js changed, reloading triggers"}}
[debug] [2025-11-19T01:00:18.695Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/brand.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/brand.js changed, reloading triggers"}}
[info] Serving at port 8711

[debug] [2025-11-19T01:00:18.909Z] Got response from /__/functions.yaml {"endpoints":{"api":{"availableMemoryMb":1024,"timeoutSeconds":120,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"httpsTrigger":{},"entryPoint":"api"},"scheduleNotifications":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"scheduleTrigger":{"schedule":"every 3 hours","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetrySeconds":null,"minBackoffSeconds":null,"maxBackoffSeconds":null},"timeZone":null},"entryPoint":"scheduleNotifications"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{}}
[debug] [2025-11-19T01:00:19.697Z] Validating nodejs source
[debug] [2025-11-19T01:00:19.980Z] > [functions] package.json contents: {
  "name": "platelens-functions",
  "version": "0.1.0",
  "main": "lib/index.js",
  "scripts": {
    "sync:shared": "node ./scripts/sync-shared.cjs",
    "build": "npm run sync:shared && tsc -p tsconfig.json",
    "clean": "rimraf lib src/shared",
    "deploy": "firebase deploy --only functions",
    "serve": "firebase emulators:start --only functions",
    "lint": "eslint --ext .ts src",
    "typecheck": "tsc --noEmit"
  },
  "engines": {
    "node": "20"
  },
  "dependencies": {
    "axios": "^1.7.7",
    "cors": "^2.8.5",
    "express": "^4.19.2",
    "firebase-admin": "^12.6.0",
    "firebase-functions": "^7.0.0",
    "form-data": "^4.0.0",
    "openai": "^4.77.0",
    "sharp-phash": "^2.0.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.17.6",
    "@typescript-eslint/eslint-plugin": "^8.11.0",
    "@typescript-eslint/parser": "^8.11.0",
    "eslint": "^8.57.1",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "rimraf": "^6.0.1",
    "typescript": "^5.6.3"
  }
}
[debug] [2025-11-19T01:00:19.980Z] Building nodejs source
[debug] [2025-11-19T01:00:19.980Z] Failed to find version of module node: reached end of search path /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules
[info] ✔  functions: Using node@22 from host. 
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T01:00:19.980Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-11-19T01:00:19.981Z] Found firebase-functions binary at '/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8417

[debug] [2025-11-19T01:00:20.240Z] Got response from /__/functions.yaml {"endpoints":{"api":{"availableMemoryMb":1024,"timeoutSeconds":120,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"httpsTrigger":{},"entryPoint":"api"},"scheduleNotifications":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"scheduleTrigger":{"schedule":"every 3 hours","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetrySeconds":null,"minBackoffSeconds":null,"maxBackoffSeconds":null},"timeZone":null},"entryPoint":"scheduleNotifications"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{}}
[info] ✔  functions: Loaded functions definitions from source: api, scheduleNotifications. {"metadata":{"emulator":{"name":"functions"},"message":"Loaded functions definitions from source: api, scheduleNotifications."}}
[info] ✔  functions: Loaded functions definitions from source: api, scheduleNotifications. {"metadata":{"emulator":{"name":"functions"},"message":"Loaded functions definitions from source: api, scheduleNotifications."}}
[info] ✔  functions: Loaded functions definitions from source: api, scheduleNotifications. {"metadata":{"emulator":{"name":"functions"},"message":"Loaded functions definitions from source: api, scheduleNotifications."}}
[debug] [2025-11-19T01:05:21.179Z] [work-queue] {"queuedWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T01:05:21.178Z"],"queueLength":1,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:05:21.179Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T01:05:21.178Z"],"workRunningCount":1}
[debug] [2025-11-19T01:05:21.179Z] Accepted request POST /platelens-3333/us-central1/api/v1/scan --> us-central1-api
[debug] [2025-11-19T01:05:21.182Z] [functions] Runtime ready! Sending request! {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Runtime ready! Sending request!"}}
[debug] [2025-11-19T01:05:21.183Z] [functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan"}}
[debug] [2025-11-19T01:05:21.183Z] [worker-pool] Cleaned up workers for us-central1-api: 1 --> 0 {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] Cleaned up workers for us-central1-api: 1 --> 0"}}
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T01:05:21.186Z] [worker-pool] addWorker(us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] addWorker(us-central1-api)"}}
[debug] [2025-11-19T01:05:21.186Z] [worker-pool] Adding worker with key us-central1-api, total=1 {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] Adding worker with key us-central1-api, total=1"}}
[debug] [2025-11-19T01:05:21.670Z] Nov 18, 2025 8:05:21 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:05:21 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-11-19T01:05:21.673Z] Nov 18, 2025 8:05:21 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:05:21 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-11-19T01:05:21.787Z] [runtime-status] [799] Resolved module firebase-admin {"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Resolved module firebase-admin {\"declared\":true,\"installed\":true,\"version\":\"12.7.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js\"}"}}
[debug] [2025-11-19T01:05:21.788Z] [runtime-status] [799] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T01:05:21.788Z] [runtime-status] [799] Outgoing network have been stubbed. [{"name":"http","status":"mocked"},{"name":"http","status":"mocked"},{"name":"https","status":"mocked"},{"name":"https","status":"mocked"},{"name":"net","status":"mocked"}] {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Outgoing network have been stubbed. [{\"name\":\"http\",\"status\":\"mocked\"},{\"name\":\"http\",\"status\":\"mocked\"},{\"name\":\"https\",\"status\":\"mocked\"},{\"name\":\"https\",\"status\":\"mocked\"},{\"name\":\"net\",\"status\":\"mocked\"}]"}}
[debug] [2025-11-19T01:05:21.788Z] [runtime-status] [799] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T01:05:21.788Z] [runtime-status] [799] Detected firebase-functions v7+, skipping config helper. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Detected firebase-functions v7+, skipping config helper."}}
[debug] [2025-11-19T01:05:21.788Z] [runtime-status] [799] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T01:05:21.788Z] [runtime-status] [799] Detected firebase-functions v7+, skipping legacy stubs. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Detected firebase-functions v7+, skipping legacy stubs."}}
[debug] [2025-11-19T01:05:21.788Z] [runtime-status] [799] Resolved module firebase-admin {"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Resolved module firebase-admin {\"declared\":true,\"installed\":true,\"version\":\"12.7.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js\"}"}}
[debug] [2025-11-19T01:05:21.792Z] [runtime-status] [799] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T01:05:21.880Z] [runtime-status] [799] firebase-admin has been stubbed. {"adminResolution":{"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js"}} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] firebase-admin has been stubbed. {\"adminResolution\":{\"declared\":true,\"installed\":true,\"version\":\"12.7.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js\"}}"}}
[debug] [2025-11-19T01:05:21.982Z] [runtime-status] [799] Functions runtime initialized. {"cwd":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions","node_version":"22.14.0"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Functions runtime initialized. {\"cwd\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions\",\"node_version\":\"22.14.0\"}"}}
[debug] [2025-11-19T01:05:21.983Z] [runtime-status] [799] Listening to port: /var/folders/8k/71zjnl9j7_58g18fylbn44sr0000gn/T/fire_emu_0e4d8b5367360656.sock {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [799] Listening to port: /var/folders/8k/71zjnl9j7_58g18fylbn44sr0000gn/T/fire_emu_0e4d8b5367360656.sock"}}
[debug] [2025-11-19T01:05:21.998Z] [worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: IDLE"}}
[debug] [2025-11-19T01:05:21.998Z] [worker-pool] submitRequest(triggerId=us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] submitRequest(triggerId=us-central1-api)"}}
[info] i  functions: Beginning execution of "us-central1-api" {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Beginning execution of \"us-central1-api\""}}
[debug] [2025-11-19T01:05:21.998Z] [worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: BUSY {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: BUSY"}}
[info] >  Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required {"user":"Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required"}}
[info] >  This will become an error in a future version of the SDK. {"user":"This will become an error in a future version of the SDK.","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m This will become an error in a future version of the SDK."}}
[warn] ⚠  External network resource requested!
   - URL: "https://api.openai.com/v1/chat/completions"
 - Be careful, this may be a production service. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"External network resource requested!\n   - URL: \"https://api.openai.com/v1/chat/completions\"\n - Be careful, this may be a production service."}}
[info] >  OpenAI vision detection error: BadRequestError: 400 Unrecognized request argument supplied: reasoning_effort {"user":"OpenAI vision detection error: BadRequestError: 400 Unrecognized request argument supplied: reasoning_effort","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m OpenAI vision detection error: BadRequestError: 400 Unrecognized request argument supplied: reasoning_effort"}}
[info] >      at APIError.generate (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/error.js:45:20) {"user":"    at APIError.generate (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/error.js:45:20)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at APIError.generate (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/error.js:45:20)"}}
[info] >      at OpenAI.makeStatusError (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:302:33) {"user":"    at OpenAI.makeStatusError (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:302:33)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at OpenAI.makeStatusError (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:302:33)"}}
[info] >      at OpenAI.makeRequest (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:346:30) {"user":"    at OpenAI.makeRequest (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:346:30)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at OpenAI.makeRequest (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/openai/core.js:346:30)"}}
[info] >      at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {"user":"    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at process.processTicksAndRejections (node:internal/process/task_queues:105:5)"}}
[info] >      at async /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:129:20 {"user":"    at async /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:129:20","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:129:20"}}
[info] >      at async retryWithBackoff (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:234:20) {"user":"    at async retryWithBackoff (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:234:20)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async retryWithBackoff (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:234:20)"}}
[info] >      at async detectFoodFromImage (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:128:28) {"user":"    at async detectFoodFromImage (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:128:28)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async detectFoodFromImage (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js:128:28)"}}
[info] >      at async handleScan (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js:19:26) { {"user":"    at async handleScan (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js:19:26) {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     at async handleScan (/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js:19:26) {"}}
[info] >    status: 400, {"user":"  status: 400,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   status: 400,"}}
[info] >    headers: { {"user":"  headers: {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   headers: {"}}
[info] >      'access-control-expose-headers': 'X-Request-ID', {"user":"    'access-control-expose-headers': 'X-Request-ID',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'access-control-expose-headers': 'X-Request-ID',"}}
[info] >      'alt-svc': 'h3=":443"; ma=86400', {"user":"    'alt-svc': 'h3=\":443\"; ma=86400',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'alt-svc': 'h3=\":443\"; ma=86400',"}}
[info] >      'cf-cache-status': 'DYNAMIC', {"user":"    'cf-cache-status': 'DYNAMIC',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'cf-cache-status': 'DYNAMIC',"}}
[info] >      'cf-ray': '9a0bcc822b249a91-MIA', {"user":"    'cf-ray': '9a0bcc822b249a91-MIA',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'cf-ray': '9a0bcc822b249a91-MIA',"}}
[info] >      connection: 'keep-alive', {"user":"    connection: 'keep-alive',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     connection: 'keep-alive',"}}
[info] >      'content-length': '168', {"user":"    'content-length': '168',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'content-length': '168',"}}
[info] >      'content-type': 'application/json', {"user":"    'content-type': 'application/json',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'content-type': 'application/json',"}}
[info] >      date: 'Wed, 19 Nov 2025 01:05:27 GMT', {"user":"    date: 'Wed, 19 Nov 2025 01:05:27 GMT',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     date: 'Wed, 19 Nov 2025 01:05:27 GMT',"}}
[info] >      'openai-organization': 'teamsquad', {"user":"    'openai-organization': 'teamsquad',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-organization': 'teamsquad',"}}
[info] >      'openai-processing-ms': '549', {"user":"    'openai-processing-ms': '549',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-processing-ms': '549',"}}
[info] >      'openai-project': 'proj_W75W4LWVMlP0dG4dTTAgnHKy', {"user":"    'openai-project': 'proj_W75W4LWVMlP0dG4dTTAgnHKy',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-project': 'proj_W75W4LWVMlP0dG4dTTAgnHKy',"}}
[info] >      'openai-version': '2020-10-01', {"user":"    'openai-version': '2020-10-01',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'openai-version': '2020-10-01',"}}
[info] >      server: 'cloudflare', {"user":"    server: 'cloudflare',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     server: 'cloudflare',"}}
[info] >      'set-cookie': '__cf_bm=jTpOKUvhf3FgQ8k4SSt81fKbPD5PMB38d2uRCt1ObyU-1763514327-1.0.1.1-217r61G7CHGQy_FuLbwupQF9U27Cnug5CqXSghLZx1rMY2laqgywEISYY5QK48T3AsNYfArlEltzl6RqwRM9fORTkICKXsR2971qO.xDs9w; path=/; expires=Wed, 19-Nov-25 01:35:27 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=vu4_vVjrLFp.DcSiIwn4u6G2Q8v8AANnTN1xzzyUS3c-1763514327740-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None', {"user":"    'set-cookie': '__cf_bm=jTpOKUvhf3FgQ8k4SSt81fKbPD5PMB38d2uRCt1ObyU-1763514327-1.0.1.1-217r61G7CHGQy_FuLbwupQF9U27Cnug5CqXSghLZx1rMY2laqgywEISYY5QK48T3AsNYfArlEltzl6RqwRM9fORTkICKXsR2971qO.xDs9w; path=/; expires=Wed, 19-Nov-25 01:35:27 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=vu4_vVjrLFp.DcSiIwn4u6G2Q8v8AANnTN1xzzyUS3c-1763514327740-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'set-cookie': '__cf_bm=jTpOKUvhf3FgQ8k4SSt81fKbPD5PMB38d2uRCt1ObyU-1763514327-1.0.1.1-217r61G7CHGQy_FuLbwupQF9U27Cnug5CqXSghLZx1rMY2laqgywEISYY5QK48T3AsNYfArlEltzl6RqwRM9fORTkICKXsR2971qO.xDs9w; path=/; expires=Wed, 19-Nov-25 01:35:27 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=vu4_vVjrLFp.DcSiIwn4u6G2Q8v8AANnTN1xzzyUS3c-1763514327740-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None',"}}
[info] >      'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', {"user":"    'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',"}}
[info] >      'x-content-type-options': 'nosniff', {"user":"    'x-content-type-options': 'nosniff',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-content-type-options': 'nosniff',"}}
[info] >      'x-envoy-upstream-service-time': '748', {"user":"    'x-envoy-upstream-service-time': '748',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-envoy-upstream-service-time': '748',"}}
[info] >      'x-openai-proxy-wasm': 'v0.1', {"user":"    'x-openai-proxy-wasm': 'v0.1',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-openai-proxy-wasm': 'v0.1',"}}
[info] >      'x-ratelimit-limit-input-images': '50000', {"user":"    'x-ratelimit-limit-input-images': '50000',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-limit-input-images': '50000',"}}
[info] >      'x-ratelimit-limit-requests': '30000', {"user":"    'x-ratelimit-limit-requests': '30000',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-limit-requests': '30000',"}}
[info] >      'x-ratelimit-limit-tokens': '150000000', {"user":"    'x-ratelimit-limit-tokens': '150000000',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-limit-tokens': '150000000',"}}
[info] >      'x-ratelimit-remaining-input-images': '49999', {"user":"    'x-ratelimit-remaining-input-images': '49999',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-remaining-input-images': '49999',"}}
[info] >      'x-ratelimit-remaining-requests': '29999', {"user":"    'x-ratelimit-remaining-requests': '29999',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-remaining-requests': '29999',"}}
[info] >      'x-ratelimit-remaining-tokens': '149998467', {"user":"    'x-ratelimit-remaining-tokens': '149998467',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-remaining-tokens': '149998467',"}}
[info] >      'x-ratelimit-reset-input-images': '1ms', {"user":"    'x-ratelimit-reset-input-images': '1ms',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-reset-input-images': '1ms',"}}
[info] >      'x-ratelimit-reset-requests': '2ms', {"user":"    'x-ratelimit-reset-requests': '2ms',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-reset-requests': '2ms',"}}
[info] >      'x-ratelimit-reset-tokens': '0s', {"user":"    'x-ratelimit-reset-tokens': '0s',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-ratelimit-reset-tokens': '0s',"}}
[info] >      'x-request-id': 'req_afb25b7922d0480ca0af36f510747a83' {"user":"    'x-request-id': 'req_afb25b7922d0480ca0af36f510747a83'","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     'x-request-id': 'req_afb25b7922d0480ca0af36f510747a83'"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    request_id: 'req_afb25b7922d0480ca0af36f510747a83', {"user":"  request_id: 'req_afb25b7922d0480ca0af36f510747a83',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   request_id: 'req_afb25b7922d0480ca0af36f510747a83',"}}
[info] >    error: { {"user":"  error: {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   error: {"}}
[info] >      message: 'Unrecognized request argument supplied: reasoning_effort', {"user":"    message: 'Unrecognized request argument supplied: reasoning_effort',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     message: 'Unrecognized request argument supplied: reasoning_effort',"}}
[info] >      type: 'invalid_request_error', {"user":"    type: 'invalid_request_error',","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     type: 'invalid_request_error',"}}
[info] >      param: null, {"user":"    param: null,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     param: null,"}}
[info] >      code: null {"user":"    code: null","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     code: null"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    code: null, {"user":"  code: null,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   code: null,"}}
[info] >    param: null, {"user":"  param: null,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   param: null,"}}
[info] >    type: 'invalid_request_error' {"user":"  type: 'invalid_request_error'","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   type: 'invalid_request_error'"}}
[info] >  } {"user":"}","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m }"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  SCAN HANDLER - SENDING TO FRONTEND: {"user":"SCAN HANDLER - SENDING TO FRONTEND:","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m SCAN HANDLER - SENDING TO FRONTEND:"}}
[info] >  Dish Title: Unknown Dish {"user":"Dish Title: Unknown Dish","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Dish Title: Unknown Dish"}}
[info] >  Number of items: 0 {"user":"Number of items: 0","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Number of items: 0"}}
[info] >  Items: [] {"user":"Items: []","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Items: []"}}
[info] >  Totals: { calories: 0, p: 0, c: 0, f: 0 } {"user":"Totals: { calories: 0, p: 0, c: 0, f: 0 }","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Totals: { calories: 0, p: 0, c: 0, f: 0 }"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[debug] [2025-11-19T01:05:27.738Z] Finishing up request with event=pause {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=pause"}}
[info] i  functions: Finished "us-central1-api" in 5739.625541ms {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finished \"us-central1-api\" in 5739.625541ms"}}
[debug] [2025-11-19T01:05:27.738Z] [worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: IDLE"}}
[debug] [2025-11-19T01:05:27.738Z] Finishing up request with event=finish {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=finish"}}
[debug] [2025-11-19T01:05:27.738Z] Finishing up request with event=close {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=close"}}
[debug] [2025-11-19T01:05:27.738Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:06:23.104Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/lib/openai.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/lib/openai.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:06:24.105Z] Validating nodejs source
[debug] [2025-11-19T01:06:24.582Z] > [functions] package.json contents: {
  "name": "platelens-functions",
  "version": "0.1.0",
  "main": "lib/index.js",
  "scripts": {
    "sync:shared": "node ./scripts/sync-shared.cjs",
    "build": "npm run sync:shared && tsc -p tsconfig.json",
    "clean": "rimraf lib src/shared",
    "deploy": "firebase deploy --only functions",
    "serve": "firebase emulators:start --only functions",
    "lint": "eslint --ext .ts src",
    "typecheck": "tsc --noEmit"
  },
  "engines": {
    "node": "20"
  },
  "dependencies": {
    "axios": "^1.7.7",
    "cors": "^2.8.5",
    "express": "^4.19.2",
    "firebase-admin": "^12.6.0",
    "firebase-functions": "^7.0.0",
    "form-data": "^4.0.0",
    "openai": "^4.77.0",
    "sharp-phash": "^2.0.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.17.6",
    "@typescript-eslint/eslint-plugin": "^8.11.0",
    "@typescript-eslint/parser": "^8.11.0",
    "eslint": "^8.57.1",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "rimraf": "^6.0.1",
    "typescript": "^5.6.3"
  }
}
[debug] [2025-11-19T01:06:24.582Z] Building nodejs source
[debug] [2025-11-19T01:06:24.582Z] Failed to find version of module node: reached end of search path /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules
[info] ✔  functions: Using node@22 from host. 
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T01:06:24.583Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-11-19T01:06:24.584Z] Found firebase-functions binary at '/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8869

[debug] [2025-11-19T01:06:24.946Z] Got response from /__/functions.yaml {"endpoints":{"api":{"availableMemoryMb":1024,"timeoutSeconds":120,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"httpsTrigger":{},"entryPoint":"api"},"scheduleNotifications":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"scheduleTrigger":{"schedule":"every 3 hours","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetrySeconds":null,"minBackoffSeconds":null,"maxBackoffSeconds":null},"timeZone":null},"entryPoint":"scheduleNotifications"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{}}
[debug] [2025-11-19T01:06:25.087Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/ai.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/ai.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.087Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/types/firestore.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/types/firestore.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.087Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/brand.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/brand.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.087Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/remoteConfig.ts changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/constants/remoteConfig.ts changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.087Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/data/foodDensity.json changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/src/shared/data/foodDensity.json changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/config.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/config.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/meals.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/meals.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/jobs/notificationCadence.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/jobs/notificationCadence.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/logs.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/logs.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/env.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/env.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/ai.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/ai.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/brand.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/brand.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/firebase.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/firebase.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/data/foodDensity.json changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/data/foodDensity.json changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/openai.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/revenuecat.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/revenuecat.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/index.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/index.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/scan.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/notify.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/notify.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/types/firestore.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/types/firestore.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/remoteConfig.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/shared/constants/remoteConfig.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/nutrition.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/lib/nutrition.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:25.996Z] File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/devices.js changed, reloading triggers {"metadata":{"emulator":{"name":"functions"},"message":"File /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/lib/handlers/devices.js changed, reloading triggers"}}
[debug] [2025-11-19T01:06:26.997Z] Validating nodejs source
[debug] [2025-11-19T01:06:27.303Z] > [functions] package.json contents: {
  "name": "platelens-functions",
  "version": "0.1.0",
  "main": "lib/index.js",
  "scripts": {
    "sync:shared": "node ./scripts/sync-shared.cjs",
    "build": "npm run sync:shared && tsc -p tsconfig.json",
    "clean": "rimraf lib src/shared",
    "deploy": "firebase deploy --only functions",
    "serve": "firebase emulators:start --only functions",
    "lint": "eslint --ext .ts src",
    "typecheck": "tsc --noEmit"
  },
  "engines": {
    "node": "20"
  },
  "dependencies": {
    "axios": "^1.7.7",
    "cors": "^2.8.5",
    "express": "^4.19.2",
    "firebase-admin": "^12.6.0",
    "firebase-functions": "^7.0.0",
    "form-data": "^4.0.0",
    "openai": "^4.77.0",
    "sharp-phash": "^2.0.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.17.6",
    "@typescript-eslint/eslint-plugin": "^8.11.0",
    "@typescript-eslint/parser": "^8.11.0",
    "eslint": "^8.57.1",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "rimraf": "^6.0.1",
    "typescript": "^5.6.3"
  }
}
[debug] [2025-11-19T01:06:27.303Z] Building nodejs source
[debug] [2025-11-19T01:06:27.303Z] Failed to find version of module node: reached end of search path /Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules
[info] ✔  functions: Using node@22 from host. 
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T01:06:27.303Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-11-19T01:06:27.304Z] Found firebase-functions binary at '/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8395

[debug] [2025-11-19T01:06:27.511Z] Got response from /__/functions.yaml {"endpoints":{"api":{"availableMemoryMb":1024,"timeoutSeconds":120,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"httpsTrigger":{},"entryPoint":"api"},"scheduleNotifications":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"scheduleTrigger":{"schedule":"every 3 hours","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetrySeconds":null,"minBackoffSeconds":null,"maxBackoffSeconds":null},"timeZone":null},"entryPoint":"scheduleNotifications"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{}}
[info] ✔  functions: Loaded functions definitions from source: api, scheduleNotifications. {"metadata":{"emulator":{"name":"functions"},"message":"Loaded functions definitions from source: api, scheduleNotifications."}}
[debug] [2025-11-19T01:06:28.959Z] [worker-pool] Shutting down IDLE worker (us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] Shutting down IDLE worker (us-central1-api)"}}
[debug] [2025-11-19T01:06:28.959Z] [worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: FINISHING {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: FINISHING"}}
[debug] [2025-11-19T01:06:28.964Z] [worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: exited {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: exited"}}
[debug] [2025-11-19T01:06:28.964Z] [worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: FINISHED {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a9b643b5-8aee-46ea-84ff-7a76060b8199]: FINISHED"}}
[info] ✔  functions: Loaded functions definitions from source: api, scheduleNotifications. {"metadata":{"emulator":{"name":"functions"},"message":"Loaded functions definitions from source: api, scheduleNotifications."}}
[debug] [2025-11-19T01:06:37.356Z] [work-queue] {"queuedWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T01:06:37.356Z"],"queueLength":1,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:06:37.356Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T01:06:37.356Z"],"workRunningCount":1}
[debug] [2025-11-19T01:06:37.356Z] Accepted request POST /platelens-3333/us-central1/api/v1/scan --> us-central1-api
[debug] [2025-11-19T01:06:37.359Z] [functions] Runtime ready! Sending request! {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Runtime ready! Sending request!"}}
[debug] [2025-11-19T01:06:37.359Z] [functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan"}}
[debug] [2025-11-19T01:06:37.359Z] [worker-pool] Cleaned up workers for us-central1-api: 1 --> 0 {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] Cleaned up workers for us-central1-api: 1 --> 0"}}
[info] i  functions: Loaded environment variables from .env. 
[debug] [2025-11-19T01:06:37.360Z] [worker-pool] addWorker(us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] addWorker(us-central1-api)"}}
[debug] [2025-11-19T01:06:37.360Z] [worker-pool] Adding worker with key us-central1-api, total=1 {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] Adding worker with key us-central1-api, total=1"}}
[debug] [2025-11-19T01:06:37.854Z] [runtime-status] [3325] Resolved module firebase-admin {"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Resolved module firebase-admin {\"declared\":true,\"installed\":true,\"version\":\"12.7.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js\"}"}}
[debug] [2025-11-19T01:06:37.854Z] [runtime-status] [3325] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T01:06:37.854Z] [runtime-status] [3325] Outgoing network have been stubbed. [{"name":"http","status":"mocked"},{"name":"http","status":"mocked"},{"name":"https","status":"mocked"},{"name":"https","status":"mocked"},{"name":"net","status":"mocked"}] {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Outgoing network have been stubbed. [{\"name\":\"http\",\"status\":\"mocked\"},{\"name\":\"http\",\"status\":\"mocked\"},{\"name\":\"https\",\"status\":\"mocked\"},{\"name\":\"https\",\"status\":\"mocked\"},{\"name\":\"net\",\"status\":\"mocked\"}]"}}
[debug] [2025-11-19T01:06:37.854Z] [runtime-status] [3325] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T01:06:37.854Z] [runtime-status] [3325] Detected firebase-functions v7+, skipping config helper. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Detected firebase-functions v7+, skipping config helper."}}
[debug] [2025-11-19T01:06:37.855Z] [runtime-status] [3325] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T01:06:37.855Z] [runtime-status] [3325] Detected firebase-functions v7+, skipping legacy stubs. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Detected firebase-functions v7+, skipping legacy stubs."}}
[debug] [2025-11-19T01:06:37.855Z] [runtime-status] [3325] Resolved module firebase-admin {"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Resolved module firebase-admin {\"declared\":true,\"installed\":true,\"version\":\"12.7.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js\"}"}}
[debug] [2025-11-19T01:06:37.858Z] [runtime-status] [3325] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Resolved module firebase-functions {\"declared\":true,\"installed\":true,\"version\":\"7.0.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-functions/lib/v2/index.js\"}"}}
[debug] [2025-11-19T01:06:37.869Z] Nov 18, 2025 8:06:37 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:06:37 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-11-19T01:06:37.873Z] Nov 18, 2025 8:06:37 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:06:37 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-11-19T01:06:37.950Z] [runtime-status] [3325] firebase-admin has been stubbed. {"adminResolution":{"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js"}} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] firebase-admin has been stubbed. {\"adminResolution\":{\"declared\":true,\"installed\":true,\"version\":\"12.7.0\",\"resolution\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions/node_modules/firebase-admin/lib/index.js\"}}"}}
[debug] [2025-11-19T01:06:38.049Z] [runtime-status] [3325] Functions runtime initialized. {"cwd":"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions","node_version":"22.14.0"} {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Functions runtime initialized. {\"cwd\":\"/Users/marianofacundoscigliano/Documents/Personal/PlateLens/functions\",\"node_version\":\"22.14.0\"}"}}
[debug] [2025-11-19T01:06:38.049Z] [runtime-status] [3325] Listening to port: /var/folders/8k/71zjnl9j7_58g18fylbn44sr0000gn/T/fire_emu_97ca3badf55ea9f6.sock {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[runtime-status] [3325] Listening to port: /var/folders/8k/71zjnl9j7_58g18fylbn44sr0000gn/T/fire_emu_97ca3badf55ea9f6.sock"}}
[debug] [2025-11-19T01:06:38.073Z] [worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE"}}
[debug] [2025-11-19T01:06:38.073Z] [worker-pool] submitRequest(triggerId=us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] submitRequest(triggerId=us-central1-api)"}}
[info] i  functions: Beginning execution of "us-central1-api" {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Beginning execution of \"us-central1-api\""}}
[debug] [2025-11-19T01:06:38.073Z] [worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: BUSY {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: BUSY"}}
[info] >  Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required {"user":"Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required"}}
[info] >  This will become an error in a future version of the SDK. {"user":"This will become an error in a future version of the SDK.","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m This will become an error in a future version of the SDK."}}
[warn] ⚠  External network resource requested!
   - URL: "https://api.openai.com/v1/chat/completions"
 - Be careful, this may be a production service. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"External network resource requested!\n   - URL: \"https://api.openai.com/v1/chat/completions\"\n - Be careful, this may be a production service."}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  RAW AI RESPONSE: {"user":"RAW AI RESPONSE:","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m RAW AI RESPONSE:"}}
[info] >  {"dishTitle":"Albondigas (Mexican Meatball Soup)","ingredientsList":[{"name":"Beef meatballs (85% lean)","portion_text":"about 5 small meatballs","estimated_weight_g":150,"calories":375,"macros":{"p":39,"c":0,"f":26},"notes":"Ground beef formed into meatballs; binder (egg/breadcrumbs) assumed minimal"},{"name":"Carrots","portion_text":"1/2 cup sliced","estimated_weight_g":70,"calories":29,"macros":{"p":1,"c":7,"f":0},"notes":"Cooked in the soup"},{"name":"Potatoes","portion_text":"3/4 cup chunks","estimated_weight_g":110,"calories":85,"macros":{"p":2,"c":19,"f":0},"notes":"Cooked"},{"name":"Tomato broth","portion_text":"1 cup","estimated_weight_g":240,"calories":40,"macros":{"p":2,"c":8,"f":0},"notes":"Tomato-based stock/broth"},{"name":"Others","portion_text":"onion, garlic, cilantro, spices, ~1 tsp olive oil","estimated_weight_g":45,"calories":60,"macros":{"p":1,"c":4,"f":5},"notes":"Combined minor aromatics and small amount of oil"}],"confidence":0.78} {"user":{"dishTitle":"Albondigas (Mexican Meatball Soup)","ingredientsList":[{"name":"Beef meatballs (85% lean)","portion_text":"about 5 small meatballs","estimated_weight_g":150,"calories":375,"macros":{"p":39,"c":0,"f":26},"notes":"Ground beef formed into meatballs; binder (egg/breadcrumbs) assumed minimal"},{"name":"Carrots","portion_text":"1/2 cup sliced","estimated_weight_g":70,"calories":29,"macros":{"p":1,"c":7,"f":0},"notes":"Cooked in the soup"},{"name":"Potatoes","portion_text":"3/4 cup chunks","estimated_weight_g":110,"calories":85,"macros":{"p":2,"c":19,"f":0},"notes":"Cooked"},{"name":"Tomato broth","portion_text":"1 cup","estimated_weight_g":240,"calories":40,"macros":{"p":2,"c":8,"f":0},"notes":"Tomato-based stock/broth"},{"name":"Others","portion_text":"onion, garlic, cilantro, spices, ~1 tsp olive oil","estimated_weight_g":45,"calories":60,"macros":{"p":1,"c":4,"f":5},"notes":"Combined minor aromatics and small amount of oil"}],"confidence":0.78},"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m {\"dishTitle\":\"Albondigas (Mexican Meatball Soup)\",\"ingredientsList\":[{\"name\":\"Beef meatballs (85% lean)\",\"portion_text\":\"about 5 small meatballs\",\"estimated_weight_g\":150,\"calories\":375,\"macros\":{\"p\":39,\"c\":0,\"f\":26},\"notes\":\"Ground beef formed into meatballs; binder (egg/breadcrumbs) assumed minimal\"},{\"name\":\"Carrots\",\"portion_text\":\"1/2 cup sliced\",\"estimated_weight_g\":70,\"calories\":29,\"macros\":{\"p\":1,\"c\":7,\"f\":0},\"notes\":\"Cooked in the soup\"},{\"name\":\"Potatoes\",\"portion_text\":\"3/4 cup chunks\",\"estimated_weight_g\":110,\"calories\":85,\"macros\":{\"p\":2,\"c\":19,\"f\":0},\"notes\":\"Cooked\"},{\"name\":\"Tomato broth\",\"portion_text\":\"1 cup\",\"estimated_weight_g\":240,\"calories\":40,\"macros\":{\"p\":2,\"c\":8,\"f\":0},\"notes\":\"Tomato-based stock/broth\"},{\"name\":\"Others\",\"portion_text\":\"onion, garlic, cilantro, spices, ~1 tsp olive oil\",\"estimated_weight_g\":45,\"calories\":60,\"macros\":{\"p\":1,\"c\":4,\"f\":5},\"notes\":\"Combined minor aromatics and small amount of oil\"}],\"confidence\":0.78}"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  PARSED AI VISION RESPONSE: {"user":"PARSED AI VISION RESPONSE:","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m PARSED AI VISION RESPONSE:"}}
[info] >  Dish Title: Albondigas (Mexican Meatball Soup) {"user":"Dish Title: Albondigas (Mexican Meatball Soup)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Dish Title: Albondigas (Mexican Meatball Soup)"}}
[info] >  Number of ingredients: 5 {"user":"Number of ingredients: 5","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Number of ingredients: 5"}}
[info] >  Ingredients: [ {"user":"Ingredients: [","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Ingredients: ["}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Beef meatballs (85% lean)", {"user":"    \"name\": \"Beef meatballs (85% lean)\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Beef meatballs (85% lean)\","}}
[info] >      "portion_text": "about 5 small meatballs", {"user":"    \"portion_text\": \"about 5 small meatballs\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"about 5 small meatballs\","}}
[info] >      "estimated_weight_g": 150, {"user":"    \"estimated_weight_g\": 150,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 150,"}}
[info] >      "calories": 375, {"user":"    \"calories\": 375,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 375,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 39, {"user":"      \"p\": 39,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 39,"}}
[info] >        "c": 0, {"user":"      \"c\": 0,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 0,"}}
[info] >        "f": 26 {"user":"      \"f\": 26","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 26"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Ground beef formed into meatballs; binder (egg/breadcrumbs) assumed minimal" {"user":"    \"notes\": \"Ground beef formed into meatballs; binder (egg/breadcrumbs) assumed minimal\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Ground beef formed into meatballs; binder (egg/breadcrumbs) assumed minimal\""}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Carrots", {"user":"    \"name\": \"Carrots\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Carrots\","}}
[info] >      "portion_text": "1/2 cup sliced", {"user":"    \"portion_text\": \"1/2 cup sliced\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"1/2 cup sliced\","}}
[info] >      "estimated_weight_g": 70, {"user":"    \"estimated_weight_g\": 70,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 70,"}}
[info] >      "calories": 29, {"user":"    \"calories\": 29,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 29,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 1, {"user":"      \"p\": 1,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 1,"}}
[info] >        "c": 7, {"user":"      \"c\": 7,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 7,"}}
[info] >        "f": 0 {"user":"      \"f\": 0","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 0"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Cooked in the soup" {"user":"    \"notes\": \"Cooked in the soup\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Cooked in the soup\""}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Potatoes", {"user":"    \"name\": \"Potatoes\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Potatoes\","}}
[info] >      "portion_text": "3/4 cup chunks", {"user":"    \"portion_text\": \"3/4 cup chunks\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"3/4 cup chunks\","}}
[info] >      "estimated_weight_g": 110, {"user":"    \"estimated_weight_g\": 110,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 110,"}}
[info] >      "calories": 85, {"user":"    \"calories\": 85,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 85,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 2, {"user":"      \"p\": 2,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 2,"}}
[info] >        "c": 19, {"user":"      \"c\": 19,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 19,"}}
[info] >        "f": 0 {"user":"      \"f\": 0","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 0"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Cooked" {"user":"    \"notes\": \"Cooked\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Cooked\""}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Tomato broth", {"user":"    \"name\": \"Tomato broth\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Tomato broth\","}}
[info] >      "portion_text": "1 cup", {"user":"    \"portion_text\": \"1 cup\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"1 cup\","}}
[info] >      "estimated_weight_g": 240, {"user":"    \"estimated_weight_g\": 240,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 240,"}}
[info] >      "calories": 40, {"user":"    \"calories\": 40,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 40,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 2, {"user":"      \"p\": 2,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 2,"}}
[info] >        "c": 8, {"user":"      \"c\": 8,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 8,"}}
[info] >        "f": 0 {"user":"      \"f\": 0","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 0"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Tomato-based stock/broth" {"user":"    \"notes\": \"Tomato-based stock/broth\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Tomato-based stock/broth\""}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Others", {"user":"    \"name\": \"Others\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Others\","}}
[info] >      "portion_text": "onion, garlic, cilantro, spices, ~1 tsp olive oil", {"user":"    \"portion_text\": \"onion, garlic, cilantro, spices, ~1 tsp olive oil\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"onion, garlic, cilantro, spices, ~1 tsp olive oil\","}}
[info] >      "estimated_weight_g": 45, {"user":"    \"estimated_weight_g\": 45,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 45,"}}
[info] >      "calories": 60, {"user":"    \"calories\": 60,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 60,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 1, {"user":"      \"p\": 1,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 1,"}}
[info] >        "c": 4, {"user":"      \"c\": 4,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 4,"}}
[info] >        "f": 5 {"user":"      \"f\": 5","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 5"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Combined minor aromatics and small amount of oil" {"user":"    \"notes\": \"Combined minor aromatics and small amount of oil\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Combined minor aromatics and small amount of oil\""}}
[info] >    } {"user":"  }","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   }"}}
[info] >  ] {"user":"]","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ]"}}
[info] >  Confidence: 0.78 {"user":"Confidence: 0.78","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Confidence: 0.78"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  SCAN HANDLER - SENDING TO FRONTEND: {"user":"SCAN HANDLER - SENDING TO FRONTEND:","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m SCAN HANDLER - SENDING TO FRONTEND:"}}
[info] >  Dish Title: Albondigas (Mexican Meatball Soup) {"user":"Dish Title: Albondigas (Mexican Meatball Soup)","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Dish Title: Albondigas (Mexican Meatball Soup)"}}
[info] >  Number of items: 5 {"user":"Number of items: 5","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Number of items: 5"}}
[info] >  Items: [ {"user":"Items: [","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Items: ["}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Beef meatballs (85% lean)", {"user":"    \"name\": \"Beef meatballs (85% lean)\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Beef meatballs (85% lean)\","}}
[info] >      "calories": 375 {"user":"    \"calories\": 375","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 375"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Carrots", {"user":"    \"name\": \"Carrots\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Carrots\","}}
[info] >      "calories": 29 {"user":"    \"calories\": 29","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 29"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Potatoes", {"user":"    \"name\": \"Potatoes\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Potatoes\","}}
[info] >      "calories": 85 {"user":"    \"calories\": 85","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 85"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Tomato broth", {"user":"    \"name\": \"Tomato broth\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Tomato broth\","}}
[info] >      "calories": 40 {"user":"    \"calories\": 40","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 40"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Others", {"user":"    \"name\": \"Others\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Others\","}}
[info] >      "calories": 60 {"user":"    \"calories\": 60","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 60"}}
[info] >    } {"user":"  }","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   }"}}
[info] >  ] {"user":"]","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ]"}}
[info] >  Totals: { calories: 589, p: 45, c: 38, f: 31 } {"user":"Totals: { calories: 589, p: 45, c: 38, f: 31 }","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Totals: { calories: 589, p: 45, c: 38, f: 31 }"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[debug] [2025-11-19T01:07:26.848Z] Finishing up request with event=pause {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=pause"}}
[info] i  functions: Finished "us-central1-api" in 48775.105084ms {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finished \"us-central1-api\" in 48775.105084ms"}}
[debug] [2025-11-19T01:07:26.849Z] [worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE"}}
[debug] [2025-11-19T01:07:26.849Z] Finishing up request with event=finish {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=finish"}}
[debug] [2025-11-19T01:07:26.849Z] Finishing up request with event=close {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=close"}}
[debug] [2025-11-19T01:07:26.849Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:08:12.836Z] [work-queue] {"queuedWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T01:08:12.836Z"],"queueLength":1,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:08:12.837Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":["/platelens-3333/us-central1/api/v1/scan-2025-11-19T01:08:12.836Z"],"workRunningCount":1}
[debug] [2025-11-19T01:08:12.837Z] Accepted request POST /platelens-3333/us-central1/api/v1/scan --> us-central1-api
[debug] [2025-11-19T01:08:12.839Z] [functions] Runtime ready! Sending request! {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Runtime ready! Sending request!"}}
[debug] [2025-11-19T01:08:12.839Z] [functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Got req.url=/platelens-3333/us-central1/api/v1/scan, mapping to path=/v1/scan"}}
[debug] [2025-11-19T01:08:12.840Z] [worker-pool] submitRequest(triggerId=us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] submitRequest(triggerId=us-central1-api)"}}
[info] i  functions: Beginning execution of "us-central1-api" {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Beginning execution of \"us-central1-api\""}}
[debug] [2025-11-19T01:08:12.840Z] [worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: BUSY {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: BUSY"}}
[info] >  Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required {"user":"Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Zod field at `#/definitions/food_detection/properties/ingredientsList/items/properties/notes` uses `.optional()` without `.nullable()` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required"}}
[info] >  This will become an error in a future version of the SDK. {"user":"This will become an error in a future version of the SDK.","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m This will become an error in a future version of the SDK."}}
[debug] [2025-11-19T01:08:14.167Z] Nov 18, 2025 8:08:14 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:08:14 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-11-19T01:08:14.175Z] Nov 18, 2025 8:08:14 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:08:14 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  RAW AI RESPONSE: {"user":"RAW AI RESPONSE:","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m RAW AI RESPONSE:"}}
[info] >  {"dishTitle":"Spaghetti and Meatballs with Marinara","ingredientsList":[{"name":"Cooked spaghetti","portion_text":"about 2 cups cooked","estimated_weight_g":300,"calories":470,"macros":{"p":17,"c":92,"f":3},"notes":"Typical serving of cooked spaghetti"},{"name":"Beef/pork meatballs","portion_text":"3 large meatballs","estimated_weight_g":180,"calories":470,"macros":{"p":29,"c":9,"f":36},"notes":"Assumes mixed meat with some breadcrumbs"},{"name":"Marinara sauce","portion_text":"about 3/4 cup","estimated_weight_g":180,"calories":100,"macros":{"p":3,"c":14,"f":3},"notes":"Tomato-based sauce"},{"name":"Parmesan cheese, grated","portion_text":"2 tablespoons","estimated_weight_g":10,"calories":43,"macros":{"p":4,"c":0,"f":3},"notes":"Sprinkled on top"},{"name":"Others","portion_text":"olive oil, garlic, basil, seasonings","estimated_weight_g":16,"calories":120,"macros":{"p":0,"c":1,"f":14},"notes":"Oil for cooking and light garnish; herbs/spices minimal calories"}],"confidence":0.83} {"user":{"dishTitle":"Spaghetti and Meatballs with Marinara","ingredientsList":[{"name":"Cooked spaghetti","portion_text":"about 2 cups cooked","estimated_weight_g":300,"calories":470,"macros":{"p":17,"c":92,"f":3},"notes":"Typical serving of cooked spaghetti"},{"name":"Beef/pork meatballs","portion_text":"3 large meatballs","estimated_weight_g":180,"calories":470,"macros":{"p":29,"c":9,"f":36},"notes":"Assumes mixed meat with some breadcrumbs"},{"name":"Marinara sauce","portion_text":"about 3/4 cup","estimated_weight_g":180,"calories":100,"macros":{"p":3,"c":14,"f":3},"notes":"Tomato-based sauce"},{"name":"Parmesan cheese, grated","portion_text":"2 tablespoons","estimated_weight_g":10,"calories":43,"macros":{"p":4,"c":0,"f":3},"notes":"Sprinkled on top"},{"name":"Others","portion_text":"olive oil, garlic, basil, seasonings","estimated_weight_g":16,"calories":120,"macros":{"p":0,"c":1,"f":14},"notes":"Oil for cooking and light garnish; herbs/spices minimal calories"}],"confidence":0.83},"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m {\"dishTitle\":\"Spaghetti and Meatballs with Marinara\",\"ingredientsList\":[{\"name\":\"Cooked spaghetti\",\"portion_text\":\"about 2 cups cooked\",\"estimated_weight_g\":300,\"calories\":470,\"macros\":{\"p\":17,\"c\":92,\"f\":3},\"notes\":\"Typical serving of cooked spaghetti\"},{\"name\":\"Beef/pork meatballs\",\"portion_text\":\"3 large meatballs\",\"estimated_weight_g\":180,\"calories\":470,\"macros\":{\"p\":29,\"c\":9,\"f\":36},\"notes\":\"Assumes mixed meat with some breadcrumbs\"},{\"name\":\"Marinara sauce\",\"portion_text\":\"about 3/4 cup\",\"estimated_weight_g\":180,\"calories\":100,\"macros\":{\"p\":3,\"c\":14,\"f\":3},\"notes\":\"Tomato-based sauce\"},{\"name\":\"Parmesan cheese, grated\",\"portion_text\":\"2 tablespoons\",\"estimated_weight_g\":10,\"calories\":43,\"macros\":{\"p\":4,\"c\":0,\"f\":3},\"notes\":\"Sprinkled on top\"},{\"name\":\"Others\",\"portion_text\":\"olive oil, garlic, basil, seasonings\",\"estimated_weight_g\":16,\"calories\":120,\"macros\":{\"p\":0,\"c\":1,\"f\":14},\"notes\":\"Oil for cooking and light garnish; herbs/spices minimal calories\"}],\"confidence\":0.83}"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  PARSED AI VISION RESPONSE: {"user":"PARSED AI VISION RESPONSE:","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m PARSED AI VISION RESPONSE:"}}
[info] >  Dish Title: Spaghetti and Meatballs with Marinara {"user":"Dish Title: Spaghetti and Meatballs with Marinara","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Dish Title: Spaghetti and Meatballs with Marinara"}}
[info] >  Number of ingredients: 5 {"user":"Number of ingredients: 5","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Number of ingredients: 5"}}
[info] >  Ingredients: [ {"user":"Ingredients: [","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Ingredients: ["}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Cooked spaghetti", {"user":"    \"name\": \"Cooked spaghetti\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Cooked spaghetti\","}}
[info] >      "portion_text": "about 2 cups cooked", {"user":"    \"portion_text\": \"about 2 cups cooked\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"about 2 cups cooked\","}}
[info] >      "estimated_weight_g": 300, {"user":"    \"estimated_weight_g\": 300,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 300,"}}
[info] >      "calories": 470, {"user":"    \"calories\": 470,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 470,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 17, {"user":"      \"p\": 17,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 17,"}}
[info] >        "c": 92, {"user":"      \"c\": 92,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 92,"}}
[info] >        "f": 3 {"user":"      \"f\": 3","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 3"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Typical serving of cooked spaghetti" {"user":"    \"notes\": \"Typical serving of cooked spaghetti\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Typical serving of cooked spaghetti\""}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Beef/pork meatballs", {"user":"    \"name\": \"Beef/pork meatballs\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Beef/pork meatballs\","}}
[info] >      "portion_text": "3 large meatballs", {"user":"    \"portion_text\": \"3 large meatballs\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"3 large meatballs\","}}
[info] >      "estimated_weight_g": 180, {"user":"    \"estimated_weight_g\": 180,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 180,"}}
[info] >      "calories": 470, {"user":"    \"calories\": 470,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 470,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 29, {"user":"      \"p\": 29,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 29,"}}
[info] >        "c": 9, {"user":"      \"c\": 9,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 9,"}}
[info] >        "f": 36 {"user":"      \"f\": 36","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 36"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Assumes mixed meat with some breadcrumbs" {"user":"    \"notes\": \"Assumes mixed meat with some breadcrumbs\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Assumes mixed meat with some breadcrumbs\""}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Marinara sauce", {"user":"    \"name\": \"Marinara sauce\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Marinara sauce\","}}
[info] >      "portion_text": "about 3/4 cup", {"user":"    \"portion_text\": \"about 3/4 cup\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"about 3/4 cup\","}}
[info] >      "estimated_weight_g": 180, {"user":"    \"estimated_weight_g\": 180,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 180,"}}
[info] >      "calories": 100, {"user":"    \"calories\": 100,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 100,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 3, {"user":"      \"p\": 3,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 3,"}}
[info] >        "c": 14, {"user":"      \"c\": 14,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 14,"}}
[info] >        "f": 3 {"user":"      \"f\": 3","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 3"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Tomato-based sauce" {"user":"    \"notes\": \"Tomato-based sauce\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Tomato-based sauce\""}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Parmesan cheese, grated", {"user":"    \"name\": \"Parmesan cheese, grated\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Parmesan cheese, grated\","}}
[info] >      "portion_text": "2 tablespoons", {"user":"    \"portion_text\": \"2 tablespoons\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"2 tablespoons\","}}
[info] >      "estimated_weight_g": 10, {"user":"    \"estimated_weight_g\": 10,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 10,"}}
[info] >      "calories": 43, {"user":"    \"calories\": 43,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 43,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 4, {"user":"      \"p\": 4,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 4,"}}
[info] >        "c": 0, {"user":"      \"c\": 0,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 0,"}}
[info] >        "f": 3 {"user":"      \"f\": 3","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 3"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Sprinkled on top" {"user":"    \"notes\": \"Sprinkled on top\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Sprinkled on top\""}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Others", {"user":"    \"name\": \"Others\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Others\","}}
[info] >      "portion_text": "olive oil, garlic, basil, seasonings", {"user":"    \"portion_text\": \"olive oil, garlic, basil, seasonings\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"portion_text\": \"olive oil, garlic, basil, seasonings\","}}
[info] >      "estimated_weight_g": 16, {"user":"    \"estimated_weight_g\": 16,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"estimated_weight_g\": 16,"}}
[info] >      "calories": 120, {"user":"    \"calories\": 120,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 120,"}}
[info] >      "macros": { {"user":"    \"macros\": {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"macros\": {"}}
[info] >        "p": 0, {"user":"      \"p\": 0,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"p\": 0,"}}
[info] >        "c": 1, {"user":"      \"c\": 1,","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"c\": 1,"}}
[info] >        "f": 14 {"user":"      \"f\": 14","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m       \"f\": 14"}}
[info] >      }, {"user":"    },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     },"}}
[info] >      "notes": "Oil for cooking and light garnish; herbs/spices minimal calories" {"user":"    \"notes\": \"Oil for cooking and light garnish; herbs/spices minimal calories\"","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"notes\": \"Oil for cooking and light garnish; herbs/spices minimal calories\""}}
[info] >    } {"user":"  }","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   }"}}
[info] >  ] {"user":"]","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ]"}}
[info] >  Confidence: 0.83 {"user":"Confidence: 0.83","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Confidence: 0.83"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[info] >  SCAN HANDLER - SENDING TO FRONTEND: {"user":"SCAN HANDLER - SENDING TO FRONTEND:","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m SCAN HANDLER - SENDING TO FRONTEND:"}}
[info] >  Dish Title: Spaghetti and Meatballs with Marinara {"user":"Dish Title: Spaghetti and Meatballs with Marinara","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Dish Title: Spaghetti and Meatballs with Marinara"}}
[info] >  Number of items: 5 {"user":"Number of items: 5","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Number of items: 5"}}
[info] >  Items: [ {"user":"Items: [","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Items: ["}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Cooked spaghetti", {"user":"    \"name\": \"Cooked spaghetti\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Cooked spaghetti\","}}
[info] >      "calories": 470 {"user":"    \"calories\": 470","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 470"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Beef/pork meatballs", {"user":"    \"name\": \"Beef/pork meatballs\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Beef/pork meatballs\","}}
[info] >      "calories": 470 {"user":"    \"calories\": 470","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 470"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Marinara sauce", {"user":"    \"name\": \"Marinara sauce\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Marinara sauce\","}}
[info] >      "calories": 100 {"user":"    \"calories\": 100","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 100"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Parmesan cheese, grated", {"user":"    \"name\": \"Parmesan cheese, grated\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Parmesan cheese, grated\","}}
[info] >      "calories": 43 {"user":"    \"calories\": 43","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 43"}}
[info] >    }, {"user":"  },","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   },"}}
[info] >    { {"user":"  {","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   {"}}
[info] >      "name": "Others", {"user":"    \"name\": \"Others\",","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"name\": \"Others\","}}
[info] >      "calories": 120 {"user":"    \"calories\": 120","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m     \"calories\": 120"}}
[info] >    } {"user":"  }","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m   }"}}
[info] >  ] {"user":"]","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ]"}}
[info] >  Totals: { calories: 1203, p: 53, c: 116, f: 59 } {"user":"Totals: { calories: 1203, p: 53, c: 116, f: 59 }","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m Totals: { calories: 1203, p: 53, c: 116, f: 59 }"}}
[info] >  ======================================== {"user":"========================================","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"\u001b[90m> \u001b[39m ========================================"}}
[debug] [2025-11-19T01:09:01.065Z] Finishing up request with event=pause {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=pause"}}
[info] i  functions: Finished "us-central1-api" in 48225.158167ms {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finished \"us-central1-api\" in 48225.158167ms"}}
[debug] [2025-11-19T01:09:01.065Z] [worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE"}}
[debug] [2025-11-19T01:09:01.065Z] Finishing up request with event=finish {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=finish"}}
[debug] [2025-11-19T01:09:01.065Z] Finishing up request with event=close {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=close"}}
[debug] [2025-11-19T01:09:01.065Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:09:21.986Z] [work-queue] {"queuedWork":["/platelens-3333/us-central1/api/v1/meals-2025-11-19T01:09:21.986Z"],"queueLength":1,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:09:21.987Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":["/platelens-3333/us-central1/api/v1/meals-2025-11-19T01:09:21.986Z"],"workRunningCount":1}
[debug] [2025-11-19T01:09:21.987Z] Accepted request POST /platelens-3333/us-central1/api/v1/meals --> us-central1-api
[debug] [2025-11-19T01:09:21.989Z] [functions] Runtime ready! Sending request! {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Runtime ready! Sending request!"}}
[debug] [2025-11-19T01:09:21.990Z] [functions] Got req.url=/platelens-3333/us-central1/api/v1/meals, mapping to path=/v1/meals {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Got req.url=/platelens-3333/us-central1/api/v1/meals, mapping to path=/v1/meals"}}
[debug] [2025-11-19T01:09:21.990Z] [worker-pool] submitRequest(triggerId=us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] submitRequest(triggerId=us-central1-api)"}}
[info] i  functions: Beginning execution of "us-central1-api" {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Beginning execution of \"us-central1-api\""}}
[debug] [2025-11-19T01:09:21.992Z] [worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: BUSY {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: BUSY"}}
[debug] [2025-11-19T01:09:22.133Z] Nov 18, 2025 8:09:22 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:09:22 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2025-11-19T01:09:22.202Z] Finishing up request with event=pause {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=pause"}}
[info] i  functions: Finished "us-central1-api" in 210.762292ms {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finished \"us-central1-api\" in 210.762292ms"}}
[debug] [2025-11-19T01:09:22.203Z] [worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE"}}
[debug] [2025-11-19T01:09:22.203Z] Finishing up request with event=finish {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=finish"}}
[debug] [2025-11-19T01:09:22.203Z] Finishing up request with event=close {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=close"}}
[debug] [2025-11-19T01:09:22.203Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:09:22.360Z] Nov 18, 2025 8:09:22 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:09:22 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-11-19T01:09:22.366Z] Nov 18, 2025 8:09:22 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:09:22 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2025-11-19T01:09:22.385Z] [work-queue] {"queuedWork":["/platelens-3333/us-central1/api/v1/meals/today-2025-11-19T01:09:22.385Z"],"queueLength":1,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:09:22.385Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":["/platelens-3333/us-central1/api/v1/meals/today-2025-11-19T01:09:22.385Z"],"workRunningCount":1}
[debug] [2025-11-19T01:09:22.385Z] Accepted request GET /platelens-3333/us-central1/api/v1/meals/today?uid=test-user-123 --> us-central1-api
[debug] [2025-11-19T01:09:22.386Z] [functions] Runtime ready! Sending request! {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Runtime ready! Sending request!"}}
[debug] [2025-11-19T01:09:22.386Z] [functions] Got req.url=/platelens-3333/us-central1/api/v1/meals/today?uid=test-user-123, mapping to path=/v1/meals/today?uid=test-user-123 {"metadata":{"emulator":{"name":"functions"},"message":"[functions] Got req.url=/platelens-3333/us-central1/api/v1/meals/today?uid=test-user-123, mapping to path=/v1/meals/today?uid=test-user-123"}}
[debug] [2025-11-19T01:09:22.386Z] [worker-pool] submitRequest(triggerId=us-central1-api) {"metadata":{"emulator":{"name":"functions"},"message":"[worker-pool] submitRequest(triggerId=us-central1-api)"}}
[info] i  functions: Beginning execution of "us-central1-api" {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Beginning execution of \"us-central1-api\""}}
[debug] [2025-11-19T01:09:22.386Z] [worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: BUSY {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: BUSY"}}
[debug] [2025-11-19T01:09:22.403Z] Finishing up request with event=pause {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=pause"}}
[info] i  functions: Finished "us-central1-api" in 17.442208ms {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finished \"us-central1-api\" in 17.442208ms"}}
[debug] [2025-11-19T01:09:22.404Z] [worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"[worker-us-central1-api-a3b7d2ca-d644-4acc-a78e-1b126b4aad88]: IDLE"}}
[debug] [2025-11-19T01:09:22.404Z] Finishing up request with event=finish {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=finish"}}
[debug] [2025-11-19T01:09:22.404Z] Finishing up request with event=close {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-api"},"extension":{},"message":"Finishing up request with event=close"}}
[debug] [2025-11-19T01:09:22.404Z] [work-queue] {"queuedWork":[],"queueLength":0,"runningWork":[],"workRunningCount":0}
[debug] [2025-11-19T01:09:24.367Z] Nov 18, 2025 8:09:24 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:09:24 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2025-11-19T01:09:24.375Z] Nov 18, 2025 8:09:24 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Nov 18, 2025 8:09:24 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
